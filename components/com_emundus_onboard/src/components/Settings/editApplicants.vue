<template>
    <div class="container-evaluation">
      <div class="section-sub-menu sub-form">
        <div class="container-2 w-container" style="max-width: unset">
          <div class="d-flex">
            <img src="images/emundus/menus/megaphone.svg" class="tchooz-icon-title" alt="megaphone">
            <h1 class="tchooz-section-titles">{{ Applicants }}</h1>
          </div>
          <p class="mt-1">{{Desc}}</p>
        </div>
      </div>
      <div class="form-group" v-for="(param, index) in params">
        <label :for="'param_' + index">{{param.label}}</label>
        <select class="dropdown-toggle w-select" :id="'param_' + index" v-model="param.value" style="margin-bottom: 0" @change="saveEmundusParam(param)">
          <option v-for="(option, index) in param.options" :value="option.value">{{option.label}}</option>
        </select>
      </div>
    </div>
</template>

<script>
    import axios from "axios";
    import VSwatches from 'vue-swatches'
    import 'vue-swatches/dist/vue-swatches.css'

    const qs = require("qs");

    export default {
        name: "editApplicants",

        components: {
            VSwatches
        },

        props: {},

        data() {
            return {
                params: {
                  applicant_can_renew: {
                    label: Joomla.JText._("COM_EMUNDUS_ONBOARD_SETTINGS_APPLICANT_CAN_RENEW"),
                    param: 'applicant_can_renew',
                    options: [
                      {
                        label: Joomla.JText._("JNO"),
                        value: 0,
                      },
                      {
                        label: Joomla.JText._("JYES"),
                        value: 1,
                      },
                      {
                        label: Joomla.JText._("COM_EMUNDUS_APPLICANT_CAN_RENEW_CAMPAIGN"),
                        value: 2,
                      },
                      {
                        label: Joomla.JText._("COM_EMUNDUS_APPLICANT_CAN_RENEW_YEAR"),
                        value: 3,
                      },
                    ],
                    value: 0,
                  },
                  can_edit_until_deadline: {
                    label: Joomla.JText._("COM_EMUNDUS_ONBOARD_SETTINGS_APPLICANT_CAN_EDIT_UNTIL_DEADLINE"),
                    param: 'can_edit_until_deadline',
                    options: [
                      {
                        label: Joomla.JText._("JNO"),
                        value: 0,
                      },
                      {
                        label: Joomla.JText._("JYES"),
                        value: 1,
                      },
                    ],
                    value: 0,
                  },
                  copy_application_form: {
                    label: Joomla.JText._("COM_EMUNDUS_ONBOARD_SETTINGS_APPLICANT_COPY_APPLICATION_FORM"),
                    param: 'copy_application_form',
                    options: [
                      {
                        label: Joomla.JText._("JNO"),
                        value: 0,
                      },
                      {
                        label: Joomla.JText._("JYES"),
                        value: 1,
                      },
                    ],
                    value: 0,
                  },
                  can_submit_encrypted: {
                    label: Joomla.JText._("COM_EMUNDUS_ONBOARD_SETTINGS_APPLICANT_CAN_SUBMIT_ENCRYPTED"),
                    param: 'can_submit_encrypted',
                    options: [
                      {
                        label: Joomla.JText._("JNO"),
                        value: 0,
                      },
                      {
                        label: Joomla.JText._("JYES"),
                        value: 1,
                      },
                    ],
                    value: 0,
                  }
                },
                config: {},
                Desc: Joomla.JText._("COM_EMUNDUS_ONBOARD_SETTINGS_APPLICANTS_DESC"),
                Applicants: Joomla.JText._("COM_EMUNDUS_ONBOARD_SETTINGS_APPLICANTS"),
            };
        },

        methods: {
            getEmundusParams() {
                axios.get("index.php?option=com_emundus_onboard&controller=settings&task=getemundusparams")
                    .then(response => {
                      this.config = response.data.config;
                      this.params.applicant_can_renew.value = parseInt(this.config.applicant_can_renew);
                      this.params.can_edit_until_deadline.value = parseInt(this.config.can_edit_until_deadline);
                      this.params.copy_application_form.value = parseInt(this.config.copy_application_form);
                      this.params.can_submit_encrypted.value = parseInt(this.config.can_submit_encrypted);
                    });
            },

            saveEmundusParam(param) {
                this.$emit("LaunchLoading");
                axios({
                    method: "post",
                    url: 'index.php?option=com_emundus_onboard&controller=settings&task=updateemundusparam',
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                  data: qs.stringify({
                    param: param.param,
                    value: param.value,
                  })
                }).then(() => {
                  this.$emit("StopLoading");
                });
            },
        },

        created() {
            this.getEmundusParams();
        }
    };
</script>
<style scoped>
    .form-group label{
      width: 100%;
    }
    .dropdown-toggle{
      width: 30%;
    }
</style>
