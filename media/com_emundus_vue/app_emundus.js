(function(t){function e(e){for(var a,n,c=e[0],o=e[1],l=e[2],h=0,m=[];h<c.length;h++)n=c[h],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&m.push(i[n][0]),i[n]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);d&&d(e);while(m.length)m.shift()();return r.push.apply(r,l||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],a=!0,c=1;c<s.length;c++){var o=s[c];0!==i[o]&&(a=!1)}a&&(r.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},i={app:0},r=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],o=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var d=o;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"002f":function(t,e,s){"use strict";s("6821")},"0d31":function(t,e,s){"use strict";s("97af")},"0fd5":function(t,e,s){var a={"./af":"8206","./af.js":"8206","./ar":"cdac","./ar-dz":"7f26","./ar-dz.js":"7f26","./ar-kw":"8e88","./ar-kw.js":"8e88","./ar-ly":"cd65","./ar-ly.js":"cd65","./ar-ma":"e8d6","./ar-ma.js":"e8d6","./ar-sa":"a284","./ar-sa.js":"a284","./ar-tn":"64f7","./ar-tn.js":"64f7","./ar.js":"cdac","./az":"b139","./az.js":"b139","./be":"98e2","./be.js":"98e2","./bg":"a1a5","./bg.js":"a1a5","./bm":"4d0d","./bm.js":"4d0d","./bn":"e8ae","./bn-bd":"5dd8","./bn-bd.js":"5dd8","./bn.js":"e8ae","./bo":"bcf2","./bo.js":"bcf2","./br":"69f1","./br.js":"69f1","./bs":"24d1","./bs.js":"24d1","./ca":"3507","./ca.js":"3507","./cs":"d15f","./cs.js":"d15f","./cv":"7bfe","./cv.js":"7bfe","./cy":"1d35","./cy.js":"1d35","./da":"a019","./da.js":"a019","./de":"0cfa","./de-at":"edea","./de-at.js":"edea","./de-ch":"9aae","./de-ch.js":"9aae","./de.js":"0cfa","./dv":"1722","./dv.js":"1722","./el":"5390","./el.js":"5390","./en-au":"dad9","./en-au.js":"dad9","./en-ca":"6f13","./en-ca.js":"6f13","./en-gb":"6267","./en-gb.js":"6267","./en-ie":"80b1","./en-ie.js":"80b1","./en-il":"ad38","./en-il.js":"ad38","./en-in":"eb60","./en-in.js":"eb60","./en-nz":"39db","./en-nz.js":"39db","./en-sg":"c30d","./en-sg.js":"c30d","./eo":"1a30","./eo.js":"1a30","./es":"48a3","./es-do":"f306","./es-do.js":"f306","./es-mx":"56d9","./es-mx.js":"56d9","./es-us":"60bf","./es-us.js":"60bf","./es.js":"48a3","./et":"f891","./et.js":"f891","./eu":"a403","./eu.js":"a403","./fa":"ce14","./fa.js":"ce14","./fi":"fc14","./fi.js":"fc14","./fil":"f46e","./fil.js":"f46e","./fo":"2bf2","./fo.js":"2bf2","./fr":"c1e8","./fr-ca":"50a2","./fr-ca.js":"50a2","./fr-ch":"b087","./fr-ch.js":"b087","./fr.js":"c1e8","./fy":"4665","./fy.js":"4665","./ga":"b396","./ga.js":"b396","./gd":"056c","./gd.js":"056c","./gl":"efde","./gl.js":"efde","./gom-deva":"12ea","./gom-deva.js":"12ea","./gom-latn":"8e2c","./gom-latn.js":"8e2c","./gu":"533d","./gu.js":"533d","./he":"7520","./he.js":"7520","./hi":"d2f3","./hi.js":"d2f3","./hr":"7e79","./hr.js":"7e79","./hu":"148f","./hu.js":"148f","./hy-am":"6711","./hy-am.js":"6711","./id":"2b10","./id.js":"2b10","./is":"1feb","./is.js":"1feb","./it":"1b21","./it-ch":"8d2c","./it-ch.js":"8d2c","./it.js":"1b21","./ja":"926e","./ja.js":"926e","./jv":"5a78","./jv.js":"5a78","./ka":"5975","./ka.js":"5975","./kk":"cc93","./kk.js":"cc93","./km":"66e1","./km.js":"66e1","./kn":"5421","./kn.js":"5421","./ko":"1297","./ko.js":"1297","./ku":"16f8","./ku.js":"16f8","./ky":"3df9","./ky.js":"3df9","./lb":"c124","./lb.js":"c124","./lo":"20a5","./lo.js":"20a5","./lt":"c14a","./lt.js":"c14a","./lv":"c553","./lv.js":"c553","./me":"ae25","./me.js":"ae25","./mi":"6f56","./mi.js":"6f56","./mk":"c8fc","./mk.js":"c8fc","./ml":"752d","./ml.js":"752d","./mn":"f09e","./mn.js":"f09e","./mr":"0a56","./mr.js":"0a56","./ms":"55b6","./ms-my":"a9e9","./ms-my.js":"a9e9","./ms.js":"55b6","./mt":"624b","./mt.js":"624b","./my":"e256","./my.js":"e256","./nb":"e1d5","./nb.js":"e1d5","./ne":"761a","./ne.js":"761a","./nl":"a0f2","./nl-be":"5cb2","./nl-be.js":"5cb2","./nl.js":"a0f2","./nn":"4fda","./nn.js":"4fda","./oc-lnc":"ec3d","./oc-lnc.js":"ec3d","./pa-in":"2f2f","./pa-in.js":"2f2f","./pl":"317f","./pl.js":"317f","./pt":"5553","./pt-br":"a9ab","./pt-br.js":"a9ab","./pt.js":"5553","./ro":"db12","./ro.js":"db12","./ru":"7aa4","./ru.js":"7aa4","./sd":"e87b","./sd.js":"e87b","./se":"a296","./se.js":"a296","./si":"51ec","./si.js":"51ec","./sk":"608b","./sk.js":"608b","./sl":"b367","./sl.js":"b367","./sq":"f68f","./sq.js":"f68f","./sr":"0991","./sr-cyrl":"c577","./sr-cyrl.js":"c577","./sr.js":"0991","./ss":"cf76","./ss.js":"cf76","./sv":"0153","./sv.js":"0153","./sw":"cb6f","./sw.js":"cb6f","./ta":"8bfa","./ta.js":"8bfa","./te":"668b","./te.js":"668b","./tet":"eae7","./tet.js":"eae7","./tg":"70b1","./tg.js":"70b1","./th":"7180","./th.js":"7180","./tk":"4912","./tk.js":"4912","./tl-ph":"f8bb","./tl-ph.js":"f8bb","./tlh":"b026","./tlh.js":"b026","./tr":"371d","./tr.js":"371d","./tzl":"c744","./tzl.js":"c744","./tzm":"787a","./tzm-latn":"71e0","./tzm-latn.js":"71e0","./tzm.js":"787a","./ug-cn":"6b5c","./ug-cn.js":"6b5c","./uk":"8c0c","./uk.js":"8c0c","./ur":"519e","./ur.js":"519e","./uz":"7982","./uz-latn":"3137","./uz-latn.js":"3137","./uz.js":"7982","./vi":"ae22","./vi.js":"ae22","./x-pseudo":"1129","./x-pseudo.js":"1129","./yo":"b4bf","./yo.js":"b4bf","./zh-cn":"fdc4","./zh-cn.js":"fdc4","./zh-hk":"747d","./zh-hk.js":"747d","./zh-mo":"fe39","./zh-mo.js":"fe39","./zh-tw":"d3e0","./zh-tw.js":"d3e0"};function i(t){var e=r(t);return s(e)}function r(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}i.keys=function(){return Object.keys(a)},i.resolve=r,t.exports=i,i.id="0fd5"},3665:function(t,e,s){"use strict";s("d134")},"46a2":function(t,e,s){},"4dc7":function(t,e,s){},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("e832"),i=s("209f"),r=s.n(i);const n={lang:""},c={},o={setLang({commit:t},e){t("setLang",e)}},l={setLang(t,e){t.lang=e}};var d={namespaced:!0,state:n,getters:c,actions:o,mutations:l};const h={users:{},currentUser:0,displayedUser:0,rights:{}},m={},u={setUsers({commit:t},e){t("setUser",e)},setCurrentUser({commit:t},e){t("setCurrentUser",e)},setDisplayedUser({commit:t},e){t("setDisplayedUser",e)},setAccessRights({commit:t},e){t("setAccessRights",e)}},p={setUser(t,e){e&&e.length>0&&e.forEach(e=>{t.users[e.id]=e})},setCurrentUser(t,e){t.currentUser=e},setDisplayedUser(t,e){t.displayedUser=e},setAccessRights(t,e){t.rights[e.fnum]=e.rights}};var f={namespaced:!0,state:h,getters:m,actions:u,mutations:p};const _={attachmentPath:"images/emundus/files/",attachments:{},selectedAttachment:{},previews:{},categories:{},checkedAttachments:[]},g={},v={setAttachments({commit:t},e){t("setAttachments",e)},setAttachmentsOfFnum({commit:t},e){t("setAttachmentsOfFnum",e)},updateAttachmentOfFnum({commit:t},e){t("updateAttachmentOfFnum",e)},setSelectedAttachment({commit:t},e){t("setSelectedAttachment",e)},setPreview({commit:t},e){t("setPreview",e)},setCategories({commit:t},e){t("setCategories",e)},setAttachmentPath({commit:t},e){t("setAttachmentPath",e)},setCheckedAttachments({commit:t},e){t("setCheckedAttachments",e)}},y={setAttachments(t,e){t.attachments=e},setAttachmentsOfFnum(t,e){t.attachments[e.fnum]=e.attachments},updateAttachmentOfFnum(t,e){const s=t.attachments[e.fnum].findIndex(t=>t.aid===e.attachment.aid);t.attachments[e.fnum][s]=e.attachment},setSelectedAttachment(t,e){t.selectedAttachment=e},setPreview(t,e){t.previews[e.id]=e.preview},setCategories(t,e){t.categories=e},setAttachmentPath(t,e){t.attachmentPath=e},setCheckedAttachments(t,e){t.checkedAttachments=e}};var A={namespaced:!0,state:_,getters:g,actions:v,mutations:y};const C={fnums:[]},w={},b={},E={};var T={namespaced:!0,state:C,getters:w,actions:b,mutations:E};const j={filters:[],queryFilters:{relation:"AND",groups:{0:{filters:{}}}}},k={setFilters(t,e){t.filters=e},updateQueryFilters(t,e){t.queryFilters.groups[e.group]||(t.queryFilters.groups[e.group]={relation:"AND",filters:{}}),t.queryFilters.groups[e.group].filters||(t.queryFilters.groups[e.group].filters={}),t.queryFilters.groups[e.group].filters[e.id]=e.filter},removeGroup(t,e){delete t.queryFilters.groups[e]},removeQueryFilter(t,e){delete t.queryFilters.groups[e.group].filters[e.id]},updateAndOr(t,e){"0"!=e.group?t.queryFilters.groups[e.group].relation=e.and_or:t.queryFilters.relation=e.and_or}},F={setFilters({commit:t},e){t("setFilters",e)},updateQueryFilters({commit:t},e){t("updateQueryFilters",e)},removeGroup({commit:t},e){t("removeGroup",e)},removeQueryFilter({commit:t},e){t("removeQueryFilter",e)},updateAndOr({commit:t},e){t("updateAndOr",e)}};var O={namespaced:!0,state:j,mutations:k,actions:F},U=s("94ea");a["a"].use(U["a"]);var M=new U["a"].Store({modules:{global:d,user:f,attachment:A,file:T,filterBuilder:O}}),S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"com_emundus_vue"},["attachments"===t.componentName?s("Attachments",{attrs:{fnum:t.data.fnum,user:t.data.user}}):t._e()],1)},N=[],D=s("4e22"),x=s.n(D),$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"em-attachments"}},[s("div",{staticClass:"head"},[s("div",{staticClass:"displayed-user"},[s("p",{staticClass:"name"},[t._v(" "+t._s(t.displayedUser.firstname)+" "+t._s(t.displayedUser.lastname)+" ")]),s("p",{staticClass:"email"},[t._v(t._s(t.displayedUser.email))])]),s("div",{staticClass:"prev-next-files"},[t.fnums.length>1?s("div",{staticClass:"prev",class:{active:t.fnumPosition>0},on:{click:function(e){return t.changeFile(t.fnumPosition-1)}}},[s("i",{staticClass:"small arrow left icon",attrs:{"aria-hidden":"true"}})]):t._e(),t.fnums.length>1?s("div",{staticClass:"next",class:{active:t.fnumPosition<t.fnums.length-1},on:{click:function(e){return t.changeFile(t.fnumPosition+1)}}},[s("i",{staticClass:"small arrow right icon",attrs:{"aria-hidden":"true"}})]):t._e()])]),s("div",{staticClass:"wrapper",class:{loading:t.loading}},[s("div",{attrs:{id:"filters"}},[s("div",{staticClass:"searchbar-wrapper"},[s("input",{ref:"searchbar",attrs:{id:"searchbar",type:"text",placeholder:t.translate("SEARCH")},on:{input:t.searchInFiles}}),s("span",{staticClass:"material-icons search"},[t._v("search")]),s("span",{staticClass:"material-icons clear",on:{click:t.resetSearch}},[t._v("clear")])]),s("div",{staticClass:"actions"},[s("FilterBuilder",{attrs:{id:"70",otherIds:"36"},on:{applyFilters:t.filterAttachmentSelection}}),Object.entries(t.categories).length>1?s("select",{ref:"categoryFilter",staticClass:"category-select",attrs:{name:"category"},on:{change:t.filterByCategory}},[s("option",{attrs:{value:"all"}},[t._v(t._s(t.translate("SELECT_CATEGORY")))]),t._l(t.categories,(function(e,a){return s("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(e)+" ")])}))],2):t._e(),t.canExport?s("div",{staticClass:"btn-icon-text",class:{disabled:t.checkedAttachments.length<1},on:{click:t.exportAttachments}},[s("span",{staticClass:"material-icons export"},[t._v("file_upload")]),s("span",[t._v(t._s(t.translate("EXPORT")))])]):t._e(),s("span",{staticClass:"material-icons refresh",attrs:{title:t.translate("COM_EMUNDUS_ATTACHMENTS_REFRESH_TITLE")},on:{click:function(e){return t.refreshAttachments(!0)}}},[t._v(" autorenew ")]),t.canDelete?s("span",{staticClass:"material-icons delete",class:{disabled:t.checkedAttachments.length<1},attrs:{title:t.translate("COM_EMUNDUS_ATTACHMENTS_DELETE_TITLE")},on:{click:t.confirmDeleteAttachments}},[t._v(" delete_outlined ")]):t._e()],1)]),t.attachments.length?s("div",{staticClass:"table-wrapper"},[s("table",{class:{loading:t.loading},attrs:{"aria-describedby":"Table of attachments information"}},[s("thead",[s("tr",[s("th",{attrs:{id:"check-th"}},[s("input",{staticClass:"attachment-check",attrs:{type:"checkbox"},on:{change:t.updateAllCheckedAttachments}})]),s("th",{attrs:{id:"name"},on:{click:function(e){return t.orderBy("value")}}},[t._v(" "+t._s(t.translate("NAME"))+" "),"value"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"value"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{staticClass:"date",attrs:{id:"date"},on:{click:function(e){return t.orderBy("timedate")}}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_SEND_DATE"))+" "),"timedate"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"timedate"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{staticClass:"desc",attrs:{id:"desc"},on:{click:function(e){return t.orderBy("description")}}},[t._v(" "+t._s(t.translate("DESCRIPTION"))+" "),"description"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"description"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{staticClass:"category",attrs:{id:"category"},on:{click:function(e){return t.orderBy("category")}}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_CATEGORY"))+" "),"category"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"category"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{staticClass:"status",attrs:{id:"status"},on:{click:function(e){return t.orderBy("is_validated")}}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_CHECK"))+" "),"is_validated"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"is_validated"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{attrs:{id:"user"},on:{click:function(e){return t.orderBy("user_id")}}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_UPLOADED_BY"))+" "),"user_id"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"user_id"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{attrs:{id:"modified_by"},on:{click:function(e){return t.orderBy("modified_by")}}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_MODIFIED_BY"))+" "),"modified_by"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"modified_by"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{staticClass:"date",attrs:{id:"modified"},on:{click:function(e){return t.orderBy("modified")}}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_MODIFICATION_DATE"))+" "),"modified"==t.sort.orderBy&&"asc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_upward")]):t._e(),"modified"==t.sort.orderBy&&"desc"==t.sort.order?s("span",{staticClass:"material-icons"},[t._v("arrow_downward")]):t._e()]),s("th",{staticClass:"permissions",attrs:{id:"permissions"}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_PERMISSIONS"))+" ")])])]),s("tbody",t._l(t.displayedAttachments,(function(e){return s("AttachmentRow",{key:e.aid,attrs:{attachment:e,checkedAttachmentsProp:t.checkedAttachments,canUpdate:t.canUpdate},on:{"open-modal":function(s){return t.openModal(e)},"update-checked-attachments":t.updateCheckedAttachments,"update-status":t.updateStatus,"change-permission":t.changePermission}})})),1)])]):s("p",[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_NO_ATTACHMENTS_FOUND"))+" ")])]),s("modal",{attrs:{id:"edit-modal",name:"edit",height:"70%",width:"70%",minWidth:690,minHeight:550,styles:"display:flex;flex-direction:column;justify-content:center;align-items:center;"}},[s("div",{staticClass:"modal-head"},[s("div",{staticClass:"flex-start"},[s("span",{staticClass:"material-icons",on:{click:t.closeModal}},[t._v(" navigate_before ")]),s("span",[t._v(t._s(t.selectedAttachment.filename))])]),s("div",{staticClass:"flex-end"},[s("div",{staticClass:"prev-next-attachments"},[s("div",{staticClass:"prev",class:{active:t.selectedAttachmentPosition>0},on:{click:function(e){return t.changeAttachment(t.selectedAttachmentPosition-1,!0)}}},[s("span",{staticClass:"material-icons"},[t._v(" navigate_before ")])]),s("span",{staticClass:"lvl"},[t._v(t._s(t.selectedAttachmentPosition+1)+" / "+t._s(t.displayedAttachments.length))]),s("div",{staticClass:"next",class:{active:t.selectedAttachmentPosition<t.displayedAttachments.length-1},on:{click:function(e){return t.changeAttachment(t.selectedAttachmentPosition+1)}}},[s("span",{staticClass:"material-icons"},[t._v(" navigate_next ")])])]),t.canDownload?s("a",{staticClass:"download btn-icon-text",attrs:{href:t.attachmentPath,download:""}},[s("span",{staticClass:"material-icons"},[t._v(" file_download ")]),s("span",[t._v(t._s(t.translate("LINK_TO_DOWNLOAD")))])]):t._e()])]),s("transition",{attrs:{name:t.slideTransition},on:{"before-leave":t.beforeLeaveSlide}},[t.modalLoading?t._e():s("div",{staticClass:"modal-body"},[s("AttachmentPreview",{on:{fileNotFound:function(e){t.canDownload=!1},canDownload:function(e){t.canDownload=!0}}}),s("AttachmentEdit",{attrs:{fnum:t.displayedFnum},on:{closeModal:t.closeModal,saveChanges:t.updateAttachment}})],1)])],1),t.loading?s("div",{staticClass:"vue-em-loader"}):t._e()],1)},B=[],P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"em-attachment-preview"}},[s("div",{ref:"a-preview",class:{"overflow-x":t.overflowX,"overflow-y":t.overflowY},attrs:{id:"attachment-preview"}}),s("div",{class:{active:t.msg&&t.openMsg},attrs:{id:"msg"}},[s("p",[t._v(t._s(t.msg))])])])},I=[],R=s("7338"),q=s.n(R),H=(t={"Content-Type":"application/json","Cache-Control":"no-cache"})=>q.a.create({timeout:3e4,headers:t,responseType:"json",withCredentials:!0}),L={async getAttachmentsByUser(t){try{const e=await H().get("index.php?option=com_emundus&controller=application&task=getuserattachments",{params:{user_id:t}});return e.data}catch(e){return{status:!1,msg:e.message}}},async getAttachmentsByFnum(t){try{const e=await H().get("index.php?option=com_emundus&controller=application&task=getattachmentsbyfnum",{params:{fnum:t}});return e.data.status&&("string"===typeof e.data.attachments&&(e.data.attachments=JSON.parse(e.data.attachments)),"object"===typeof e.data.attachments&&(e.data.attachments=Object.values(e.data.attachments)),e.data.attachments.forEach(t=>{t.show=!0})),e.data}catch(e){return{status:!1,msg:e.message}}},async getAttachmentCategories(){try{const t=await H().get("index.php?option=com_emundus&controller=files&task=getattachmentcategories");return t.data}catch(t){return{status:!1,msg:t.message}}},async deleteAttachments(t,e,s){try{const a=new FormData;return a.append("ids",JSON.stringify(s)),await H().post(`index.php?option=com_emundus&controller=application&task=deleteattachement&fnum=${t}&student_id=${e}`,a,{headers:{"Content-Type":"multipart/form-data"}})}catch(a){return{status:!1,msg:a.message}}},async updateAttachment(t){try{const e=await H().post("index.php?option=com_emundus&controller=application&task=updateattachment",t,{headers:{"Content-Type":"multipart/form-data"}});return e.data}catch(e){return{status:!1,msg:e.message}}},async getPreview(t,e){try{const s=await H().get("index.php?option=com_emundus&controller=application&task=getattachmentpreview",{params:{user:t,filename:e}});return s.data}catch(s){return{status:!1,msg:s.message}}},exportAttachments(t,e,s){const a=new FormData;return a.append("student_id",t),a.append("fnum",e),s.forEach(t=>{a.append("ids[]",t)}),H().post("index.php?option=com_emundus&controller=application&task=exportpdf",a,{headers:{"Content-Type":"multipart/form-data"}})},async filterAttachmentSelection(t,e){try{const s=await H().get("index.php?option=com_emundus&controller=application&task=filterattachmentselection",{params:{fnum:t,sqlRequest:encodeURI(e)}});return s.data}catch(s){return{status:!1,data:null,message:s.message}}}},V={data(){return{attachment:this.$store.state.attachment.selectedAttachment,preview:"",overflowX:!1,overflowY:!1,style:"",msg:"",openMsg:!1}},mounted(){this.attachment=this.$store.state.attachment.selectedAttachment,this.getPreview()},methods:{async getPreview(){let t;this.$store.state.attachment.previews[this.attachment.aid]?t=this.$store.state.attachment.previews[this.attachment.aid]:(t=await L.getPreview(this.$store.state.user.displayedUser,this.attachment.filename),this.$store.commit("attachment/setPreview",{preview:t,id:this.attachment.aid})),this.$emit("canDownload"),t.status?(this.preview=t.content,this.overflowX=t.overflowX,this.overflowY=t.overflowY,this.style=t.style,t.msg&&(this.msg=t.msg,this.openMsg=!0,setTimeout(()=>{this.openMsg=!1},3e3))):("file_not_found"===t.error&&this.$emit("fileNotFound"),this.overflowX=!1,this.overflowY=!1,this.preview=t.content,this.msg=""),null===this.$refs["a-preview"].shadowRoot&&this.$refs["a-preview"].attachShadow({mode:"open"}),this.$refs["a-preview"].shadowRoot.innerHTML=null!=this.preview?this.preview:"","sheet"==this.style?this.addSheetStyles():"presentation"==this.style?this.addPresentationStyles():"word"==this.style&&this.addWordStyles()},addSheetStyles(){const t=this.$refs["a-preview"].shadowRoot.querySelectorAll("div");t.forEach((t,e)=>{t.style.width="fit-content",t.style.margin="20px auto",t.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.1)",e>0&&(t.style.display="none")});const e=this.$refs["a-preview"].shadowRoot.querySelector(".navigation");e&&(e.style.display="flex",e.style.flexDirection="row",e.style.justifyContent="flex-start",e.style.alignItems="center",e.querySelectorAll("li").forEach((e,s)=>{e.style.listStyleType="none",e.style.margin="0 10px",e.addEventListener("click",()=>{t.forEach((t,e)=>{t.style.display=e==s?"block":"none"})})}))},addPresentationStyles(){const t=this.$refs["a-preview"].shadowRoot.querySelectorAll(".slide");t.forEach(t=>{t.style.padding="16px",t.style.margin="20px",t.style.width="calc(100% - 72px)",t.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.1)",t.style.borderRadius="8px",t.style.backgroundColor="white"})},addWordStyles(){const t=this.$refs["a-preview"].shadowRoot.querySelector(".wrapper");t&&(t.style.border="var(--border-color)",t.style.boxShadow="var(--box-shadow)",t.style.backgroundColor="white",t.style.padding="20px",t.style.margin="16px",t.style.overflow="hidden")}},watch:{"$store.state.attachment.selectedAttachment":function(){const t=Object.keys(this.$store.state.attachment.selectedAttachment);0!==t.length&&(this.attachment=this.$store.state.attachment.selectedAttachment,this.openMsg=!1,this.getPreview())}}},G=V,z=(s("0d31"),s("17e1")),Y=Object(z["a"])(G,P,I,!1,null,"e90b8e1e",null),J=Y.exports,Q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"attachment-edit"}},[s("div",{staticClass:"wrapper"},[s("h2",{staticClass:"title"},[t._v(t._s(t.attachment.value))]),s("div",{staticClass:"editable-data"},[s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"description"}},[t._v(t._s(t.translate("DESCRIPTION"))+" ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.attachment.description,expression:"attachment.description"}],attrs:{name:"description",type:"text",disabled:!t.canUpdate},domProps:{value:t.attachment.description},on:{input:function(e){e.target.composing||t.$set(t.attachment,"description",e.target.value)}}})]),s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"status"}},[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_CHECK")))]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.attachment.is_validated,expression:"attachment.is_validated"}],attrs:{name:"status",disabled:!t.canUpdate},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.attachment,"is_validated",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"1"}},[t._v(t._s(t.translate("VALID")))]),s("option",{attrs:{value:"0"}},[t._v(t._s(t.translate("INVALID")))]),s("option",{attrs:{value:"2"}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_WARNING"))+" ")]),s("option",{attrs:{value:"-2"}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_WAITING"))+" ")])])]),t.canUpdate?s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"replace"}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_REPLACE")))]),s("input",{attrs:{type:"file",name:"replace",accept:t.allowedType},on:{change:t.updateFile}})]):t._e(),s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"can_be_viewed"}},[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_CAN_BE_VIEWED")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.attachmentCanBeViewed,expression:"attachmentCanBeViewed"}],attrs:{type:"checkbox",name:"can_be_viewed",disabled:!t.canUpdate},domProps:{checked:Array.isArray(t.attachmentCanBeViewed)?t._i(t.attachmentCanBeViewed,null)>-1:t.attachmentCanBeViewed},on:{change:function(e){var s=t.attachmentCanBeViewed,a=e.target,i=!!a.checked;if(Array.isArray(s)){var r=null,n=t._i(s,r);a.checked?n<0&&(t.attachmentCanBeViewed=s.concat([r])):n>-1&&(t.attachmentCanBeViewed=s.slice(0,n).concat(s.slice(n+1)))}else t.attachmentCanBeViewed=i}}})]),s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"can_be_deleted"}},[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_CAN_BE_DELETED")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.attachmentCanBeDeleted,expression:"attachmentCanBeDeleted"}],attrs:{type:"checkbox",name:"can_be_deleted",disabled:!t.canUpdate},domProps:{checked:Array.isArray(t.attachmentCanBeDeleted)?t._i(t.attachmentCanBeDeleted,null)>-1:t.attachmentCanBeDeleted},on:{change:function(e){var s=t.attachmentCanBeDeleted,a=e.target,i=!!a.checked;if(Array.isArray(s)){var r=null,n=t._i(s,r);a.checked?n<0&&(t.attachmentCanBeDeleted=s.concat([r])):n>-1&&(t.attachmentCanBeDeleted=s.slice(0,n).concat(s.slice(n+1)))}else t.attachmentCanBeDeleted=i}}})])]),s("div",{staticClass:"non-editable-data"},[s("div",[s("span",[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_SEND_DATE")))]),s("span",[t._v(t._s(t.formattedDate(t.attachment.timedate)))])]),t.attachment.user_id?s("div",[s("span",[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_UPLOADED_BY")))]),s("span",[t._v(t._s(t.getUserNameById(t.attachment.user_id)))])]):t._e(),t.attachment.category?s("div",[s("span",[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_CATEGORY")))]),s("span",[t._v(t._s(this.categories[t.attachment.category]))])]):t._e(),t.attachment.modified_by?s("div",[s("span",[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_MODIFIED_BY")))]),s("span",[t._v(t._s(t.getUserNameById(t.attachment.modified_by)))])]):t._e(),t.attachment.modified?s("div",[s("span",[t._v(t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_MODIFICATION_DATE")))]),s("span",[t._v(t._s(t.formattedDate(t.attachment.modified)))])]):t._e()])]),s("div",{staticClass:"actions"},[t.canUpdate?s("button",{staticClass:"btn-primary-vue",on:{click:t.saveChanges}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_SAVE"))+" ")]):t._e()]),t.error?s("div",{staticClass:"error"},[t._v(t._s(t.errorMessage))]):t._e()])},W=[],X={async getUsers(){try{const t=await H().get("index.php?option=com_emundus&controller=users&task=getusers");return{data:t.data,status:!0}}catch(t){return{status:!1,msg:t.message}}},async getUserById(t){try{const e=await H().get("index.php?option=com_emundus&controller=users&task=getuserbyid",{params:{id:t}});return e.data}catch(e){return{status:!1,msg:e.message}}},async getAccessRights(t,e){try{const s=await H().get("index.php?option=com_emundus&controller=users&task=getattachmentaccessrights",{params:{id:t,fnum:e}});return s.data}catch(s){return{status:!1,msg:s.message}}}},K={methods:{formattedDate:function(t){return x()(t).format("LLLL")},getUserNameById:function(t){let e="";if(t&&t.length>0){const s=this.$store.state.user.users[t];s?e=s.firstname+" "+s.lastname:X.getUserById(t).then(s=>{s.status&&s.user[0]&&(e=s.user[0].firstname+" "+s.user[0].lastname,s.user[0].id=t,this.$store.dispatch("user/setUsers",s.user))})}return e},async getAttachmentCategories(){const t=await L.getAttachmentCategories();return!0===t.status?(Object.entries(t.categories).forEach(([e,s])=>{t.categories[e]=this.translate(s)}),delete t.categories[""],this.$store.dispatch("attachment/setCategories",t.categories),this.$store.state.attachment.categories):{}}}},Z=K,tt={name:"AttachmentEdit",props:{fnum:{type:String,required:!0}},mixins:[Z],data(){return{attachment:{},categories:{},file:null,canUpdate:!1,error:!1,errorMessage:""}},mounted(){this.canUpdate=!!this.$store.state.user.rights[this.fnum]&&this.$store.state.user.rights[this.fnum].canUpdate,this.attachment=this.$store.state.attachment.selectedAttachment,this.categories=this.$store.state.attachment.categories},methods:{async saveChanges(){let t=new FormData;t.append("fnum",this.fnum),t.append("user",this.$store.state.user.currentUser),t.append("id",this.attachment.aid),t.append("description",this.attachment.description),t.append("is_validated",this.attachment.is_validated),t.append("can_be_viewed",this.attachment.can_be_viewed),t.append("can_be_deleted",this.attachment.can_be_deleted),this.file&&t.append("file",this.file);const e=await L.updateAttachment(t);if(e.status.update){if(this.attachment.modified_by=this.$store.state.user.currentUser,this.$store.dispatch("attachment/updateAttachmentOfFnum",{fnum:this.fnum,attachment:this.attachment}),e.status.file_update){const t=await L.getPreview(this.$store.state.user.displayedUser,this.attachment.filename);this.$store.dispatch("attachment/setPreview",{preview:t,id:this.attachment.aid})}this.$emit("saveChanges")}else this.showError(e.msg)},updateFile(t){this.file=t.target.files[0]},showError(t){this.error=!0,this.errorMessage=t,setTimeout(()=>{this.error=!1,this.errorMessage=""},3e3)}},computed:{allowedType(){let t="";return this.attachment.filename&&(t="."+this.attachment.filename.split(".").pop()),t},attachmentCanBeViewed:{get:function(){return"1"==this.attachment.can_be_viewed},set:function(t){this.attachment.can_be_viewed=t?"1":"0"}},attachmentCanBeDeleted:{get:function(){return"1"==this.attachment.can_be_deleted},set:function(t){this.attachment.can_be_deleted=t?"1":"0"}}},watch:{"$store.state.attachment.selectedAttachment":function(){const t=Object.keys(this.$store.state.attachment.selectedAttachment);t.length>0&&(this.attachment=this.$store.state.attachment.selectedAttachment)}}},et=tt,st=(s("002f"),Object(z["a"])(et,Q,W,!1,null,"4e0dc93e",null)),at=st.exports,it=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:{active:t.open},attrs:{id:"filter-builder"}},[s("div",{staticClass:"header"},[s("p",[t._v("Filtres avancés")]),t.open?t._e():s("span",{staticClass:"material-icons click",on:{click:function(e){t.open=!0}}},[t._v(" expand_more ")]),t.open?s("span",{staticClass:"material-icons click",on:{click:function(e){t.open=!1}}},[t._v(" expand_less ")]):t._e()]),s("div",{staticClass:"actions",class:{active:t.open}},[s("div",{staticClass:"btn-secondary-vue",on:{click:t.cancel}},[t._v("Annuler")]),s("div",{staticClass:"btn-primary-vue",on:{click:t.applyFilters}},[t._v(" Appliquer les filtres ")])]),s("div",{staticClass:"filters",class:{active:t.open}},[s("div",{staticClass:"rows"},[s("div",{staticClass:"relation"},[s("div",{class:{selected:"AND"===t.andOr},on:{click:function(e){return t.toggleAndOr("AND")}}},[t._v(" ET ")]),s("div",{class:{selected:"OR"===t.andOr},on:{click:function(e){return t.toggleAndOr("OR")}}},[t._v(" OU ")])]),s("div",{staticClass:"elements"},t._l(t.orderedElements,(function(e){return s("div",{key:"filter"==e.type?e.id:e.group,staticClass:"element"},["filter"==e.type?s("FilterRow",{staticClass:"filter-row",attrs:{group:0,id:e.id},on:{removeFilter:function(e){return t.removeFilter(e)}}}):t._e(),"group"==e.type?s("FilterGroup",{attrs:{id:e.group},on:{removeGroup:function(e){return t.removeGroup(e)}}}):t._e()],1)})),0)]),s("div",{staticClass:"actions",class:{active:t.open}},[s("div",{staticClass:"btn-primary-vue",on:{click:t.addGroup}},[t._v("Ajouter un filtre")])])])])},rt=[],nt={async getFilters(t,e,s){try{const a=await H().get("index.php?option=com_emundus&controller=application&task=getfilters",{params:{type:t,id:e,otherids:s}});return a.data}catch(a){return!1}},async mountQuery(t,e){try{const s=await H().get("index.php?option=com_emundus&controller=application&task=mountquery",{params:{id:t,filters:e}});return s.data}catch(s){return!1}}},ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"filter-row",class:{"filter-delete":t.hoverDelete}},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedFilter,expression:"selectedFilter"}],attrs:{name:"filter-name"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedFilter=e.target.multiple?s:s[0]}}},t._l(t.names,(function(e){return s("option",{key:e.id,domProps:{value:e.id}},[t._v(" "+t._s(t.translate(e.label))+" ")])})),0),s("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedAction,expression:"selectedAction"}],attrs:{name:"filter-action"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedAction=e.target.multiple?s:s[0]}}},t._l(t.actions,(function(e,a){return s("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(e)+" ")])})),0),"select"==t.type?s("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedValue,expression:"selectedValue"}],attrs:{name:"filter-value"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selectedValue=e.target.multiple?s:s[0]}}},t._l(t.values,(function(e,a){return s("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(e)+" ")])})),0):"text"==t.type?s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedValue,expression:"selectedValue"}],attrs:{type:"text",name:"filter-value"},domProps:{value:t.selectedValue},on:{input:function(e){e.target.composing||(t.selectedValue=e.target.value)}}}):"number"==t.type?s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedValue,expression:"selectedValue"}],attrs:{type:"number",name:"filter-value"},domProps:{value:t.selectedValue},on:{input:function(e){e.target.composing||(t.selectedValue=e.target.value)}}}):t._e(),s("span",{staticClass:"material-icons delete",on:{click:t.removeFilter,mouseover:function(e){t.hoverDelete=!0},mouseleave:function(e){t.hoverDelete=!1}}},[t._v(" remove ")])])},ot=[],lt={props:{id:{type:Number,required:!0},group:{type:Number,default:0}},data(){return{selectedFilter:null,selectedAction:null,selectedValue:null,hoverDelete:!1,names:[]}},mounted(){this.names=this.$store.state.filterBuilder.filters.map((t,e)=>(0==e&&(this.selectedFilter=t.id,this.selectedAction=Object.keys(t.actions)[0],this.selectedValue=Object.keys(t.values)[0]),{id:t.id,label:t.label})),this.$store.state.filterBuilder.queryFilters.groups[this.group]&&this.$store.state.filterBuilder.queryFilters.groups[this.group].filters&&this.$store.state.filterBuilder.queryFilters.groups[this.group].filters[this.id]?(this.selectedFilter=this.$store.state.filterBuilder.queryFilters.groups[this.group].filters[this.id].id,this.selectedAction=this.$store.state.filterBuilder.queryFilters.groups[this.group].filters[this.id].action,this.selectedValue=this.$store.state.filterBuilder.queryFilters.groups[this.group].filters[this.id].value):this.updateFilter()},methods:{updateFilter(){this.$store.dispatch("filterBuilder/updateQueryFilters",{group:this.group,id:this.id,filter:{id:this.selectedFilter,action:this.selectedAction,value:this.selectedValue}})},removeFilter(){this.$store.dispatch("filterBuilder/removeQueryFilter",{group:this.group,id:this.id}),this.$emit("removeFilter",this.id)}},computed:{actions(){const t=this.$store.state.filterBuilder.filters.find(t=>t.id==this.selectedFilter);return t?t.actions:[]},values(){const t=this.$store.state.filterBuilder.filters.find(t=>t.id==this.selectedFilter);return t?t.values:[]},type(){const t=this.$store.state.filterBuilder.filters.find(t=>t.id==this.selectedFilter);return t?t.type:null}},watch:{selectedFilter(){this.updateFilter()},selectedAction(){this.updateFilter()},selectedValue(){this.updateFilter()}}},dt=lt,ht=(s("3665"),Object(z["a"])(dt,ct,ot,!1,null,"741485a4",null)),mt=ht.exports,ut=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.groupClasses},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"rows"},[s("div",{staticClass:"relation"},[s("div",{class:{selected:"AND"===t.andOr},on:{click:function(e){return t.toggleAndOr("AND")}}},[t._v(" ET ")]),s("div",{class:{selected:"OR"===t.andOr},on:{click:function(e){return t.toggleAndOr("OR")}}},[t._v(" OU ")])]),t._l(t.filters,(function(e){return s("FilterRow",{key:e,staticClass:"filter",attrs:{group:t.id,id:e},on:{removeFilter:function(s){return t.removeFilter(e)}}})}))],2),s("div",{staticClass:"actions add"},[s("span",{staticClass:"material-icons add btn-primary-vue",on:{click:t.addFilter}},[t._v(" add ")])])]),s("span",{staticClass:"material-icons delete-group",on:{mouseover:t.addDeleteClass,mouseleave:t.removeDeleteClass,click:t.removeGroup}},[t._v(" clear ")])])},pt=[],ft={name:"FilterGroup",props:{id:{type:Number,required:!0}},components:{FilterRow:mt},data(){return{andOr:"AND",filters:[],groupClasses:"group"}},mounted(){this.filters=this.$store.state.filterBuilder.queryFilters.groups[this.id]?Object.entries(this.$store.state.filterBuilder.queryFilters.groups[this.id].filters).map(t=>Number(t[0])):[],this.filters.length<1&&this.addFilter()},methods:{addFilter(){this.filters.push(Math.floor(Math.random()*Date.now()))},removeFilter(t){this.filters=this.filters.filter(e=>e!==t),this.filters.length<1&&this.removeGroup()},removeGroup(){this.$store.dispatch("filterBuilder/removeGroup",this.id),this.$emit("removeGroup",this.id)},toggleAndOr(t){this.andOr=t},addDeleteClass(){this.groupClasses="group to-delete"},removeDeleteClass(){this.groupClasses="group"}},watch:{andOr(){this.$store.dispatch("filterBuilder/updateAndOr",{group:this.id,and_or:this.andOr})}}},_t=ft,gt=(s("abeb"),Object(z["a"])(_t,ut,pt,!1,null,null,null)),vt=gt.exports,yt={name:"FilterBuilder",components:{FilterRow:mt,FilterGroup:vt},props:{type:{type:String,default:"list"},id:{type:String,default:"70"},otherIds:{type:String,default:null}},data(){return{open:!1,andOr:"AND",orderedElements:[]}},mounted(){this.getFilters()},methods:{async getFilters(){const t=await nt.getFilters(this.type,this.id,this.otherIds);!0===t.status&&this.$store.dispatch("filterBuilder/setFilters",t.filters)},async applyFilters(){if(this.open=!1,Object.keys(this.$store.state.filterBuilder.queryFilters.groups).length>1){const t=await nt.mountQuery(this.id,this.$store.state.filterBuilder.queryFilters);!0===t.status&&this.$emit("applyFilters",t.query)}},cancel(){this.open=!1},addGroup(){this.orderedElements.push({type:"group",group:Math.floor(Math.random()*Date.now())})},removeFilter(t){const e=this.orderedElements.findIndex(e=>e.id==t);this.orderedElements.splice(e,1)},removeGroup(t){const e=this.orderedElements.findIndex(e=>e.group==t);this.orderedElements.splice(e,1)},toggleAndOr(t){this.andOr=t}},watch:{andOr(){this.$store.dispatch("filterBuilder/updateAndOr",{group:0,and_or:this.andOr})}}},At=yt,Ct=(s("b8e6"),Object(z["a"])(At,it,rt,!1,null,null,null)),wt=Ct.exports,bt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("tr",{key:t.attachment.aid,staticClass:"attachment-row",class:{checked:t.checkedAttachments.includes(t.attachment.aid)}},[s("td",[s("input",{staticClass:"attachment-check",attrs:{type:"checkbox"},domProps:{checked:t.checkedAttachments.includes(t.attachment.aid)},on:{change:function(e){return t.updateCheckedAttachments(t.attachment.aid)}}})]),s("td",{staticClass:"td-document",on:{click:t.openModal}},[s("span",[t._v(t._s(t.attachment.value))]),t.attachment.existsOnServer?t._e():s("span",{staticClass:"material-icons warning file-not-found",attrs:{title:t.translate("COM_EMUNDUS_ATTACHMENTS_FILE_NOT_FOUND")}},[t._v(" warning ")])]),s("td",{staticClass:"date"},[t._v(t._s(t.formattedDate(t.attachment.timedate)))]),s("td",{staticClass:"desc"},[t._v(t._s(t.attachment.description))]),s("td",{staticClass:"category"},[t._v(" "+t._s(t.category)+" ")]),s("td",{staticClass:"status valid-state",class:{success:1==t.attachment.is_validated,warning:2==t.attachment.is_validated,error:0==t.attachment.is_validated}},[s("select",{attrs:{disabled:!1===t.canUpdate},on:{change:function(e){return t.updateStatus(e)}}},[s("option",{attrs:{value:"1"},domProps:{selected:1==t.attachment.is_validated}},[t._v(" "+t._s(t.translate("VALID"))+" ")]),s("option",{attrs:{value:"0"},domProps:{selected:0==t.attachment.is_validated}},[t._v(" "+t._s(t.translate("INVALID"))+" ")]),s("option",{attrs:{value:"2"},domProps:{selected:2==t.attachment.is_validated}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_WARNING"))+" ")]),s("option",{attrs:{value:"-2"},domProps:{selected:-2==t.attachment.is_validated||null===t.attachment.is_validated}},[t._v(" "+t._s(t.translate("COM_EMUNDUS_ATTACHMENTS_WAITING"))+" ")])])]),s("td",[t._v(t._s(t.getUserNameById(t.attachment.user_id)))]),s("td",[t._v(t._s(t.getUserNameById(t.attachment.modified_by)))]),s("td",{staticClass:"date"},[t._v(t._s(t.formattedDate(t.attachment.modified)))]),s("td",{staticClass:"permissions"},[s("span",{staticClass:"material-icons visibility-permission",class:{active:"1"==t.attachment.can_be_viewed},on:{click:function(e){return t.changePermission("can_be_viewed",t.attachment)}}},[t._v("visibility")]),s("span",{staticClass:"material-icons delete-permission",class:{active:"1"==t.attachment.can_be_deleted},on:{click:function(e){return t.changePermission("can_be_deleted",t.attachment)}}},[t._v("delete_outlined")])])])},Et=[],Tt={name:"AttachmentRow",props:{attachment:{type:Object,required:!0},checkedAttachmentsProp:{type:Array,required:!0},canUpdate:{type:Boolean,default:!1}},mixins:[Z],data(){return{categories:{},category:"",checkedAttachments:[]}},mounted(){this.categories=this.$store.state.attachment.categories,Object.entries(this.categories).length<1?this.getAttachmentCategories().then(t=>{this.categories=t,this.category=this.categories[this.attachment.category]?this.categories[this.attachment.category]:""}).catch(t=>{this.categories={}}):this.category=this.categories[this.attachment.category]?this.categories[this.attachment.category]:"",this.checkedAttachments=this.checkedAttachmentsProp},methods:{updateCheckedAttachments(t){this.checkedAttachments.includes(t)?this.checkedAttachments.splice(this.checkedAttachments.indexOf(t),1):this.checkedAttachments.push(t),this.$emit("update-checked-attachments",this.checkedAttachments)},openModal(){this.$emit("open-modal",this.attachment)},updateStatus(t){this.canUpdate&&this.$emit("update-status",t,this.attachment)},changePermission(t,e){this.canUpdate&&this.$emit("change-permission",t,e)}},watch:{"$store.state.attachment.checkedAttachments":function(){this.checkedAttachments=this.$store.state.attachment.checkedAttachments}}},jt=Tt,kt=(s("f909"),Object(z["a"])(jt,bt,Et,!1,null,"60d818a9",null)),Ft=kt.exports,Ot={async getFnums(){try{const t=await H().get("index.php?option=com_emundus&controller=files&task=getallfnums");return t.data}catch(t){return!1}},async getFnumInfos(t){try{const e=await H().get("index.php?option=com_emundus&controller=files&task=getfnuminfos",{params:{fnum:t}});return e.data}catch(e){return!1}}},Ut=s("ac68"),Mt=s.n(Ut),St={name:"Attachments",components:{AttachmentPreview:J,AttachmentEdit:at,AttachmentRow:Ft},props:{user:{type:String,required:!0},fnum:{type:String,required:!0}},mixins:[Z],data(){return{loading:!0,attachments:[],categories:{},fnums:[],users:[],displayedUser:{},displayedFnum:this.fnum,checkedAttachments:[],selectedAttachment:{},sort:{last:"",order:"",orderBy:""},canExport:!1,canDelete:!1,canDownload:!0,canUpdate:!1,modalLoading:!1,slideTransition:"slide-fade",changeFileEvent:null}},created(){this.changeFileEvent=new Event("changeFile")},mounted(){this.loading=!0,this.getFnums(),this.getUsers(),this.getAttachments(),this.setAccessRights()},methods:{async getFnums(){const t=document.getElementsByClassName("em_file_open");for(let e of t)this.fnums.push(e.id)},async getUsers(){const t=await X.getUsers();!1!==t.status&&(this.users=t.data,this.$store.dispatch("user/setUsers",this.users)),this.$store.dispatch("user/setCurrentUser",this.user),this.setDisplayedUser()},async setDisplayedUser(){const t=await Ot.getFnumInfos(this.displayedFnum);if(t&&t.fnumInfos){const e=!(!this.users||!this.users.length)&&this.users.find(e=>e.user_id==t.fnumInfos.applicant_id);if(e)this.displayedUser=e,this.$store.dispatch("user/setDisplayedUser",this.displayedUser.user_id);else{const e=await X.getUserById(t.fnumInfos.applicant_id);e.status?(this.users.push(e.user[0]),this.displayedUser=e.user[0],this.$store.dispatch("user/setDisplayedUser",this.displayedUser.user_id)):this.displayErrorMessage(this.translate("COM_EMUNDUS_ATTACHMENTS_USER_NOT_FOUND"))}}else this.displayErrorMessage(this.translate("COM_EMUNDUS_ATTACHMENTS_USER_NOT_FOUND"))},async getAttachments(){this.$store.state.attachment.attachments[this.displayedFnum]?(this.attachments=this.$store.state.attachment.attachments[this.displayedFnum],this.categories=this.$store.state.attachment.categories):this.refreshAttachments()},async refreshAttachments(t=!1){!0===t&&(this.loading=!0),this.resetOrder(),this.checkedAttachments=[],this.$refs["searchbar"].value="";const e=await L.getAttachmentsByFnum(this.displayedFnum);if(e.status){this.attachments=e.attachments,this.$store.dispatch("attachment/setAttachmentsOfFnum",{fnum:[this.displayedFnum],attachments:this.attachments});const t=await this.getAttachmentCategories();this.categories=t||{}}else this.displayErrorMessage(this.translate("COM_EMUNDUS_ATTACHMENTS_ERROR_GETTING_ATTACHMENTS"));!0===t&&(this.loading=!1)},updateAttachment(){this.resetOrder(),this.getAttachments(),this.$modal.hide("edit"),this.selectedAttachment={}},updateStatus(t,e){if(this.canUpdate){if(this.attachments.length<1)return;this.attachments.forEach((s,a)=>{if(s.aid==e.aid){this.resetOrder(),this.attachments[a].is_validated=t.target.value;let e=new FormData;e.append("fnum",this.displayedFnum),e.append("user",this.$store.state.user.currentUser),e.append("id",this.attachments[a].aid),e.append("is_validated",this.attachments[a].is_validated),L.updateAttachment(e).then(t=>{t&&!1===t.status&&this.displayErrorMessage(t.msg)}).catch(t=>{this.displayErrorMessage(t)})}})}},changePermission(t,e){this.canUpdate?this.attachments.forEach((s,a)=>{if(s.aid==e.aid){this.resetOrder(),this.attachments[a][t]="1"===this.attachments[a][t]?"0":"1";let e=new FormData;e.append("fnum",this.displayedFnum),e.append("user",this.$store.state.user.currentUser),e.append("id",this.attachments[a].aid),e.append(t,this.attachments[a][t]),L.updateAttachment(e).then(t=>{t.status||this.displayErrorMessage(t.msg)})}}):this.displayErrorMessage(this.translate("COM_EMUNDUS_ATTACHMENTS_UNAUTHORIZED_ACTION"))},async setAccessRights(){if(!this.$store.state.user.rights[this.displayedFnum]){const t=await X.getAccessRights(this.$store.state.user.currentUser,this.displayedFnum);!0===t.status&&this.$store.dispatch("user/setAccessRights",{fnum:this.displayedFnum,rights:t.rights})}this.canExport=!!this.$store.state.user.rights[this.displayedFnum]&&this.$store.state.user.rights[this.displayedFnum].canExport,this.canDelete=!!this.$store.state.user.rights[this.displayedFnum]&&this.$store.state.user.rights[this.displayedFnum].canDelete,this.canUpdate=!!this.$store.state.user.rights[this.displayedFnum]&&this.$store.state.user.rights[this.displayedFnum].canUpdate,this.loading=!1},async exportAttachments(){this.canExport&&L.exportAttachments(this.displayedUser.id,this.displayedFnum,this.checkedAttachments).then(t=>{!0===t.data.status?window.open(t.data.link,"_blank"):this.displayErrorMessage(t.data.msg)})},confirmDeleteAttachments(){if(this.canDelete){let t="<p>"+this.translate("CONFIRM_DELETE_SELETED_ATTACHMENTS")+"</p><br>",e="";this.checkedAttachments.forEach(t=>{this.attachments.forEach(s=>{s.aid==t&&(e+=s.value+", ")})}),e=e.substring(0,e.length-2),t+="<p>"+e+"</p>",Mt.a.fire({title:this.translate("DELETE_SELECTED_ATTACHMENTS"),html:t,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:this.translate("JYES"),cancelButtonText:this.translate("JNO"),reverseButtons:!0}).then(t=>{t.value&&this.deleteAttachments()})}else this.displayErrorMessage(this.translate("YOU_NOT_HAVE_PERMISSION_TO_DELETE_ATTACHMENTS"))},async deleteAttachments(){if(this.canDelete){this.attachments=this.attachments.filter(t=>!this.checkedAttachments.includes(t.aid));const t=await L.deleteAttachments(this.displayedFnum,this.displayedUser.id,this.checkedAttachments);t.status}else this.displayErrorMessage(this.translate("YOU_NOT_HAVE_PERMISSION_TO_DELETE_ATTACHMENTS"))},changeFile(t){this.loading=!0;const e=this.fnumPosition;this.displayedFnum=this.fnums[t],this.attachments=[],this.$store.dispatch("attachment/setCheckedAttachments",[]),this.setAccessRights(),this.resetOrder(),this.resetSearch(),this.resetCategoryFilters(),Ot.getFnumInfos(this.displayedFnum).then(s=>{!0===s.status?(this.changeFileEvent.detail={fnum:s.fnumInfos,next:t>e,previous:t<e},document.querySelector(".com_emundus_vue").dispatchEvent(this.changeFileEvent)):this.displayErrorMessage(s.msg)}),this.setDisplayedUser().then(()=>{this.getAttachments().then(()=>{this.attachments.forEach(t=>{t.show=!0}),this.loading=!1}).catch(t=>{this.displayErrorMessage(t),this.loading=!1})}).catch(t=>{this.displayErrorMessage(t),this.loading=!1})},changeAttachment(t,e=!1){this.slideTransition=e?"slide-fade-reverse":"slide-fade",this.modalLoading=!0,this.selectedAttachment=this.displayedAttachments[t],this.$store.dispatch("attachment/setSelectedAttachment",this.selectedAttachment),setTimeout(()=>{this.modalLoading=!1},500)},searchInFiles(){this.attachments.forEach((t,e)=>{t.description.toLowerCase().includes(this.$refs["searchbar"].value.toLowerCase())||t.value.toLowerCase().includes(this.$refs["searchbar"].value.toLowerCase())?this.attachments[e].show=!0:(this.checkedAttachments=this.checkedAttachments.filter(e=>e!==t.aid),this.attachments[e].show=!1)})},resetSearch(){this.attachments.forEach((t,e)=>{this.attachments[e].show=!0}),this.$refs["searchbar"].value=""},resetOrder(){this.sort={last:"",order:"",orderBy:""}},resetCategoryFilters(){this.$refs["categoryFilter"]&&(this.$refs["categoryFilter"].value="all")},orderBy(t){this.sort.last==t?(this.sort.order="asc"==this.sort.order?"desc":"asc",this.attachments.reverse()):(this.attachments.sort((e,s)=>e[t]<s[t]?-1:e[t]>s[t]?1:0),this.sort.order="asc"),this.sort.orderBy=t,this.sort.last=t},filterByCategory(t){this.attachments.forEach(e=>{"all"==t.target.value||e.category==t.target.value?e.show=!0:(this.checkedAttachments=this.checkedAttachments.filter(t=>t!==e.aid),e.show=!1)})},async filterAttachmentSelection(t){this.loading=!0;const e=await L.filterAttachmentSelection(this.displayedFnum,t);!0===e.status?this.attachments.forEach(t=>{e.data.includes(t.aid)?t.show=!0:(this.checkedAttachments=this.checkedAttachments.filter(e=>e!==t.aid),t.show=!1)}):this.displayErrorMessage(e.message),this.loading=!1},updateAllCheckedAttachments(t){t.target.checked?this.checkedAttachments=this.displayedAttachments.map(t=>t.aid):this.checkedAttachments=[],this.$store.dispatch("attachment/setCheckedAttachments",this.checkedAttachments)},updateCheckedAttachments(t){Array.isArray(t)?this.checkedAttachments=t:(console.warn("updateCheckedAttachments() expects an array as argument"),this.displayErrorMessage("Something went wrong while updating the checked attachments"),this.checkedAttachments=[])},openModal(t){this.$modal.show("edit"),this.selectedAttachment=t,this.$store.dispatch("attachment/setSelectedAttachment",t)},closeModal(){this.$modal.hide("edit"),this.selectedAttachment={},this.$store.dispatch("attachment/setSelectedAttachment",{})},displayErrorMessage(t){Mt.a.fire({title:this.translate("ERROR"),text:t,type:"error",confirmButtonColor:"#3085d6",confirmButtonText:this.translate("COM_EMUNDUS_ATTACHMENTS_CLOSE")})},beforeLeaveSlide(t){"slide-fade"==this.slideTransition&&(t.style.transform="translateX(-100%)"),t.setAttribute("class","modal-body "+this.slideTransition+"-leave-active "+this.slideTransition+"-leave-to")}},computed:{displayedAttachments(){return this.attachments.filter(t=>(!0===t.show||void 0==t.show)&&t.can_be_viewed)},fnumPosition(){return this.fnums.indexOf(this.displayedFnum)},selectedAttachmentPosition(){return this.displayedAttachments.indexOf(this.selectedAttachment)},attachmentPath(){return this.$store.state.attachment.attachmentPath+this.displayedUser.user_id+"/"+this.selectedAttachment.filename}}},Nt=St,Dt=(s("f082"),Object(z["a"])(Nt,$,B,!1,null,"483a8a35",null)),xt=Dt.exports,$t={props:{componentName:{type:String,required:!0},data:{type:Object,default:{}}},components:{Attachments:xt},mounted(){this.data.lang?this.$store.dispatch("global/setLang",this.data.lang.split("-")[0]):this.$store.dispatch("global/setLang","fr"),x.a.locale(this.$store.state.global.lang),this.data.base&&this.$store.dispatch("attachment/setAttachmentPath",this.data.base+"/images/emundus/files/")}},Bt=$t,Pt=(s("5c0b"),Object(z["a"])(Bt,S,N,!1,null,null,null)),It=Pt.exports,Rt={methods:{translate(t){return void 0!=typeof t&&null!=t?Joomla.JText._(t)?Joomla.JText._(t):t:""}}};a["a"].use(U["a"]);var qt=new U["a"].Store({modules:{filterBuilder:O}});let Ht=!1,Lt="",Vt={},Gt="";if(document.getElementById("em-application-attachment")){const t=document.getElementById("em-application-attachment");Array.prototype.slice.call(t.attributes).forEach((function(t){Vt[t.name]=t.value})),Gt="attachments",Lt="#em-application-attachment",Ht=!0}if(Ht){const t=document.querySelectorAll("#em-appli-menu .list-group-item");function zt(e){document.querySelector("#em-assoc-files .panel-body").empty();const s=document.querySelector(".em-check:checked");s&&(s.checked=!1);const a=document.getElementById(e.detail.fnum.fnum+"_check");a&&(a.checked=!0),t.forEach((function(t){t.setAttribute("href",t.getAttribute("href").replace(/fnum=\d+/,"fnum="+e.detail.fnum.fnum))})),openFiles(e.detail.fnum,"attachment",!0)}a["a"].config.productionTip=!1,a["a"].use(M),a["a"].use(r.a),a["a"].mixin(Rt);new a["a"]({el:Lt,store:M,render(t){return t(It,{props:{componentName:Gt,data:Vt}})}});document.querySelector(".com_emundus_vue").addEventListener("changeFile",zt),document.getElementById("em-vue-filter-builder")&&new a["a"]({el:"#em-vue-filter-builder",store:qt,render(t){return t(wt)}})}},"5c0b":function(t,e,s){"use strict";s("4dc7")},6821:function(t,e,s){},"7bf2":function(t,e,s){},"97af":function(t,e,s){},abeb:function(t,e,s){"use strict";s("d1a9")},b8e6:function(t,e,s){"use strict";s("eef2")},d134:function(t,e,s){},d1a9:function(t,e,s){},eef2:function(t,e,s){},f082:function(t,e,s){"use strict";s("7bf2")},f909:function(t,e,s){"use strict";s("46a2")}});
//# sourceMappingURL=app_emundus.js.map