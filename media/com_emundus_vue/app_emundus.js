(function(t){function e(e){for(var a,c,r=e[0],o=e[1],d=e[2],l=0,m=[];l<r.length;l++)c=r[l],Object.prototype.hasOwnProperty.call(n,c)&&n[c]&&m.push(n[c][0]),n[c]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);h&&h(e);while(m.length)m.shift()();return i.push.apply(i,d||[]),s()}function s(){for(var t,e=0;e<i.length;e++){for(var s=i[e],a=!0,r=1;r<s.length;r++){var o=s[r];0!==n[o]&&(a=!1)}a&&(i.splice(e--,1),t=c(c.s=s[0]))}return t}var a={},n={app:0},i=[];function c(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,c),s.l=!0,s.exports}c.m=t,c.c=a,c.d=function(t,e,s){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(c.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)c.d(s,a,function(e){return t[e]}.bind(null,a));return s},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],o=r.push.bind(r);r.push=e,r=r.slice();for(var d=0;d<r.length;d++)e(r[d]);var h=o;i.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"0936":function(t,e,s){"use strict";s("91d0")},"0fd5":function(t,e,s){var a={"./af":"8206","./af.js":"8206","./ar":"cdac","./ar-dz":"7f26","./ar-dz.js":"7f26","./ar-kw":"8e88","./ar-kw.js":"8e88","./ar-ly":"cd65","./ar-ly.js":"cd65","./ar-ma":"e8d6","./ar-ma.js":"e8d6","./ar-sa":"a284","./ar-sa.js":"a284","./ar-tn":"64f7","./ar-tn.js":"64f7","./ar.js":"cdac","./az":"b139","./az.js":"b139","./be":"98e2","./be.js":"98e2","./bg":"a1a5","./bg.js":"a1a5","./bm":"4d0d","./bm.js":"4d0d","./bn":"e8ae","./bn-bd":"5dd8","./bn-bd.js":"5dd8","./bn.js":"e8ae","./bo":"bcf2","./bo.js":"bcf2","./br":"69f1","./br.js":"69f1","./bs":"24d1","./bs.js":"24d1","./ca":"3507","./ca.js":"3507","./cs":"d15f","./cs.js":"d15f","./cv":"7bfe","./cv.js":"7bfe","./cy":"1d35","./cy.js":"1d35","./da":"a019","./da.js":"a019","./de":"0cfa","./de-at":"edea","./de-at.js":"edea","./de-ch":"9aae","./de-ch.js":"9aae","./de.js":"0cfa","./dv":"1722","./dv.js":"1722","./el":"5390","./el.js":"5390","./en-au":"dad9","./en-au.js":"dad9","./en-ca":"6f13","./en-ca.js":"6f13","./en-gb":"6267","./en-gb.js":"6267","./en-ie":"80b1","./en-ie.js":"80b1","./en-il":"ad38","./en-il.js":"ad38","./en-in":"eb60","./en-in.js":"eb60","./en-nz":"39db","./en-nz.js":"39db","./en-sg":"c30d","./en-sg.js":"c30d","./eo":"1a30","./eo.js":"1a30","./es":"48a3","./es-do":"f306","./es-do.js":"f306","./es-mx":"56d9","./es-mx.js":"56d9","./es-us":"60bf","./es-us.js":"60bf","./es.js":"48a3","./et":"f891","./et.js":"f891","./eu":"a403","./eu.js":"a403","./fa":"ce14","./fa.js":"ce14","./fi":"fc14","./fi.js":"fc14","./fil":"f46e","./fil.js":"f46e","./fo":"2bf2","./fo.js":"2bf2","./fr":"c1e8","./fr-ca":"50a2","./fr-ca.js":"50a2","./fr-ch":"b087","./fr-ch.js":"b087","./fr.js":"c1e8","./fy":"4665","./fy.js":"4665","./ga":"b396","./ga.js":"b396","./gd":"056c","./gd.js":"056c","./gl":"efde","./gl.js":"efde","./gom-deva":"12ea","./gom-deva.js":"12ea","./gom-latn":"8e2c","./gom-latn.js":"8e2c","./gu":"533d","./gu.js":"533d","./he":"7520","./he.js":"7520","./hi":"d2f3","./hi.js":"d2f3","./hr":"7e79","./hr.js":"7e79","./hu":"148f","./hu.js":"148f","./hy-am":"6711","./hy-am.js":"6711","./id":"2b10","./id.js":"2b10","./is":"1feb","./is.js":"1feb","./it":"1b21","./it-ch":"8d2c","./it-ch.js":"8d2c","./it.js":"1b21","./ja":"926e","./ja.js":"926e","./jv":"5a78","./jv.js":"5a78","./ka":"5975","./ka.js":"5975","./kk":"cc93","./kk.js":"cc93","./km":"66e1","./km.js":"66e1","./kn":"5421","./kn.js":"5421","./ko":"1297","./ko.js":"1297","./ku":"16f8","./ku.js":"16f8","./ky":"3df9","./ky.js":"3df9","./lb":"c124","./lb.js":"c124","./lo":"20a5","./lo.js":"20a5","./lt":"c14a","./lt.js":"c14a","./lv":"c553","./lv.js":"c553","./me":"ae25","./me.js":"ae25","./mi":"6f56","./mi.js":"6f56","./mk":"c8fc","./mk.js":"c8fc","./ml":"752d","./ml.js":"752d","./mn":"f09e","./mn.js":"f09e","./mr":"0a56","./mr.js":"0a56","./ms":"55b6","./ms-my":"a9e9","./ms-my.js":"a9e9","./ms.js":"55b6","./mt":"624b","./mt.js":"624b","./my":"e256","./my.js":"e256","./nb":"e1d5","./nb.js":"e1d5","./ne":"761a","./ne.js":"761a","./nl":"a0f2","./nl-be":"5cb2","./nl-be.js":"5cb2","./nl.js":"a0f2","./nn":"4fda","./nn.js":"4fda","./oc-lnc":"ec3d","./oc-lnc.js":"ec3d","./pa-in":"2f2f","./pa-in.js":"2f2f","./pl":"317f","./pl.js":"317f","./pt":"5553","./pt-br":"a9ab","./pt-br.js":"a9ab","./pt.js":"5553","./ro":"db12","./ro.js":"db12","./ru":"7aa4","./ru.js":"7aa4","./sd":"e87b","./sd.js":"e87b","./se":"a296","./se.js":"a296","./si":"51ec","./si.js":"51ec","./sk":"608b","./sk.js":"608b","./sl":"b367","./sl.js":"b367","./sq":"f68f","./sq.js":"f68f","./sr":"0991","./sr-cyrl":"c577","./sr-cyrl.js":"c577","./sr.js":"0991","./ss":"cf76","./ss.js":"cf76","./sv":"0153","./sv.js":"0153","./sw":"cb6f","./sw.js":"cb6f","./ta":"8bfa","./ta.js":"8bfa","./te":"668b","./te.js":"668b","./tet":"eae7","./tet.js":"eae7","./tg":"70b1","./tg.js":"70b1","./th":"7180","./th.js":"7180","./tk":"4912","./tk.js":"4912","./tl-ph":"f8bb","./tl-ph.js":"f8bb","./tlh":"b026","./tlh.js":"b026","./tr":"371d","./tr.js":"371d","./tzl":"c744","./tzl.js":"c744","./tzm":"787a","./tzm-latn":"71e0","./tzm-latn.js":"71e0","./tzm.js":"787a","./ug-cn":"6b5c","./ug-cn.js":"6b5c","./uk":"8c0c","./uk.js":"8c0c","./ur":"519e","./ur.js":"519e","./uz":"7982","./uz-latn":"3137","./uz-latn.js":"3137","./uz.js":"7982","./vi":"ae22","./vi.js":"ae22","./x-pseudo":"1129","./x-pseudo.js":"1129","./yo":"b4bf","./yo.js":"b4bf","./zh-cn":"fdc4","./zh-cn.js":"fdc4","./zh-hk":"747d","./zh-hk.js":"747d","./zh-mo":"fe39","./zh-mo.js":"fe39","./zh-tw":"d3e0","./zh-tw.js":"d3e0"};function n(t){var e=i(t);return s(e)}function i(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}n.keys=function(){return Object.keys(a)},n.resolve=i,t.exports=n,n.id="0fd5"},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("e832");const n={users:{},currentUser:0,displayedUser:0},i={},c={setUsers({commit:t},e){t("setUser",e)},setCurrentUser({commit:t},e){t("setCurrentUser",e)},setDisplayedUser({commit:t},e){t("setDisplayedUser",e)}},r={setUser(t,e){e.forEach(e=>{t.users[e.id]=e})},setCurrentUser(t,e){t.currentUser=e},setDisplayedUser(t,e){t.displayedUser=e}};var o={namespaced:!0,state:n,getters:i,actions:c,mutations:r};const d={attachmentPath:"images/emundus/files/",attachments:{},selectedAttachment:{},previews:{}},h={},l={setAttachments({commit:t},e){t("setAttachments",e)},setAttachmentsOfFnum({commit:t},e){t("setAttachmentsOfFnum",e)},updateAttachmentOfFnum({commit:t},e){t("updateAttachmentOfFnum",e)},setSelectedAttachment({commit:t},e){t("setSelectedAttachment",e)},setPreview({commit:t},e){t("setPreview",e)}},m={setAttachments(t,e){t.attachments=e},setAttachmentsOfFnum(t,e){t.attachments[e.fnum]=e.attachments},updateAttachmentOfFnum(t,e){const s=t.attachments[e.fnum].findIndex(t=>t.aid===e.attachment.aid);t.attachments[e.fnum][s]=e.attachment},setSelectedAttachment(t,e){t.selectedAttachment=e},setPreview(t,e){t.previews[e.id]=e.preview}};var u={namespaced:!0,state:d,getters:h,actions:l,mutations:m};const p={fnums:[]},f={},v={},y={};var j={namespaced:!0,state:p,getters:f,actions:v,mutations:y},_=s("94ea");a["a"].use(_["a"]);var b=new _["a"].Store({modules:{user:o,attachment:u,file:j}}),g=s("4af9"),w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"com_emundus_vue"},[s("router-view")],1)},A=[],k={props:{componentName:{type:String,required:!0},data:{type:Object,default:{}}},mounted(){this.$router.push({name:this.componentName,params:this.data})}},x=k,$=(s("5c0b"),s("a6c2")),C=Object($["a"])(x,w,A,!1,null,null,null),O=C.exports,S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"em-attachments"}},[s("div",{staticClass:"head"},[t.fnums.length>1?s("div",{staticClass:"prev-next-files"},[s("div",{staticClass:"prev",class:{active:t.fnumPosition>0},on:{click:t.prevFile}},[s("span",{staticClass:"material-icons"},[t._v(" navigate_before ")])]),s("div",{staticClass:"next",class:{active:t.fnumPosition<t.fnums.length-1},on:{click:t.nextFile}},[s("span",{staticClass:"material-icons"},[t._v(" navigate_next ")])])]):t._e(),s("div",{staticClass:"displayed-user"},[s("p",{staticClass:"name"},[t._v(t._s(t.displayedUser.firstname)+" "+t._s(t.displayedUser.lastname)+" ")]),s("p",{staticClass:"email"},[t._v(t._s(t.displayedUser.email))])])]),s("div",{staticClass:"wrapper",class:{loading:t.loading}},[s("div",{attrs:{id:"filters"}},[s("input",{ref:"searchbar",attrs:{id:"searchbar",type:"text",placeholder:t.$t("search")},on:{input:t.searchInFiles}}),s("div",{staticClass:"actions"},[s("span",{staticClass:"material-icons",on:{click:t.deleteAttachments}},[t._v(" delete_outlined ")])])]),t.attachments.length?s("table",[s("thead",[s("tr",[s("th",[s("input",{attrs:{type:"checkbox"},on:{change:t.updateAllCheckedAttachments}})]),s("th",{on:{click:function(e){return t.orderBy("filename")}}},[t._v(t._s(t.$t("attachments.name")))]),s("th",{on:{click:function(e){return t.orderBy("timedate")}}},[t._v(t._s(t.$t("attachments.send_date")))]),s("th",{on:{click:function(e){return t.orderBy("description")}}},[t._v(t._s(t.$t("attachments.desc")))]),s("th",{on:{click:function(e){return t.orderBy("is_validated")}}},[t._v(t._s(t.$t("attachments.status")))]),s("th",{on:{click:function(e){return t.orderBy("modified_by")}}},[t._v(t._s(t.$t("attachments.modified_by")))]),s("th",{on:{click:function(e){return t.orderBy("modified")}}},[t._v(t._s(t.$t("attachments.modification_date")))])])]),s("tbody",t._l(t.displayedAttachments,(function(e){return s("tr",{key:e.aid,class:{checked:t.checkedAttachments.includes(e.aid)}},[s("td",[s("input",{staticClass:"attachment-check",attrs:{type:"checkbox"},domProps:{checked:t.checkedAttachments.includes(e.aid)},on:{change:function(s){return t.updateCheckedAttachments(e.aid)}}})]),s("td",{staticClass:"td-document",on:{click:function(s){return t.openModal(e)}}},[t._v(t._s(e.filename))]),s("td",[t._v(t._s(t.formattedTimeDate(e.timedate)))]),s("td",[t._v(t._s(e.description))]),s("td",{staticClass:"valid-state",class:{success:1==e.is_validated,error:-2==e.is_validated}},[s("span",[t._v(t._s(t.$t("attachments.validation_states."+e.is_validated)))])]),s("td",[t._v(t._s(t.userName(e.modified_by)))]),s("td",[t._v(t._s(t.formattedTimeDate(e.modified)))])])})),0)]):s("p",[t._v("Aucun dossier rattaché à cet utilisateur")])]),s("modal",{attrs:{id:"edit-modal",name:"edit",height:"50%",width:"50%",styles:"display:flex;flex-direction:column;justify-content:center;align-items:center;"}},[s("div",{staticClass:"modal-head"},[s("div",{staticClass:"flex-start"},[s("span",{staticClass:"material-icons close",on:{click:t.closeModal}},[t._v(" navigate_before ")]),s("span",[t._v(t._s(t.selectedAttachment.filename))])]),s("div",{staticClass:"flex-end"},[s("div",{staticClass:"prev-next-attachments"},[s("div",{staticClass:"prev",class:{active:t.selectedAttachmentPosition>0},on:{click:t.prevAttachment}},[s("span",{staticClass:"material-icons"},[t._v(" navigate_before ")])]),s("span",{staticClass:"lvl"},[t._v(t._s(t.selectedAttachmentPosition+1)+" / "+t._s(t.displayedAttachments.length))]),s("div",{staticClass:"next",class:{active:t.selectedAttachmentPosition<t.displayedAttachments.length-1},on:{click:t.nextAttachment}},[s("span",{staticClass:"material-icons"},[t._v(" navigate_next ")])])]),s("a",{staticClass:"download",attrs:{href:t.attachmentPath,download:""}},[s("span",{staticClass:"material-icons"},[t._v(" download ")]),s("span",[t._v(t._s(t.$t("download")))])])])]),s("div",{staticClass:"modal-body"},[s("AttachmentPreview"),s("AttachmentEdit",{attrs:{fnum:t.displayedFnum},on:{closeModal:t.closeModal,saveChanges:t.updateAttachment}})],1)]),t.loading?s("div",{staticClass:"vue-em-loader"}):t._e()],1)},U=[],P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"a-preview",class:{"overflow-x":t.overflowX,"overflow-y":t.overflowY},attrs:{id:"attachment-preview"}})},F=[],E=s("7338"),T=s.n(E),J=(t={"Content-Type":"application/json","Cache-Control":"no-cache"})=>T.a.create({timeout:3e4,headers:t,responseType:"json",withCredentials:!0}),D={async getAttachmentsByUser(t){try{const e=await J().get("index.php?option=com_emundus&controller=application&task=getuserattachments",{params:{user_id:t}});return e.data}catch(e){throw e}},async getAttachmentsByFnum(t){try{const e=await J().get("index.php?option=com_emundus&controller=application&task=getattachmentsbyfnum",{params:{fnum:t}});return e.data.forEach(t=>{t.show=!0,t.is_validated=null===t.is_validated?"0":t.is_validated}),e.data}catch(e){throw e}},async deleteAttachments(t,e){try{const s=await J().get("index.php?option=com_emundus&controller=application&task=deleteattachement",{params:{fnum:t,ids:JSON.stringify(e)}});return s}catch(s){throw s}},async updateAttachment(t,e,s){try{const a=await J().get("index.php?option=com_emundus&controller=application&task=updateattachment",{params:{fnum:t,user:e,attachment:JSON.stringify(s)}});return a.data}catch(a){throw a}},async getPreview(t,e){try{const s=await J().get("index.php?option=com_emundus&controller=application&task=getattachmentpreview",{params:{user:t,filename:e}});return s.data}catch(s){throw s}}},I={data(){return{attachment:this.$store.state.attachment.selectedAttachment,preview:"",overflowX:!1,overflowY:!1,style:""}},mounted(){this.attachment=this.$store.state.attachment.selectedAttachment,this.getPreview()},methods:{async getPreview(){let t;this.$store.state.attachment.previews[this.attachment.aid]?t=this.$store.state.attachment.previews[this.attachment.aid]:(t=await D.getPreview(this.$store.state.user.displayedUser,this.attachment.filename),this.$store.commit("attachment/setPreview",{preview:t,id:this.attachment.aid})),t.status?(this.preview=t.content,this.overflowX=t.overflowX,this.overflowY=t.overflowY,this.style=t.style,null===this.$refs["a-preview"].shadowRoot&&this.$refs["a-preview"].attachShadow({mode:"open"})):(this.overflowX=!1,this.overflowY=!1,this.preview=""),this.$refs["a-preview"].shadowRoot.innerHTML=null!=this.preview?this.preview:"","sheet"==this.style?this.addSheetStyles():"presentation"==this.style&&this.addPresentationStyles()},addSheetStyles(){const t=this.$refs["a-preview"].shadowRoot.querySelectorAll("div");t.forEach((t,e)=>{t.style.width="fit-content",t.style.margin="20px auto",t.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.1)",e>0&&(t.style.display="none")});const e=this.$refs["a-preview"].shadowRoot.querySelector(".navigation");e&&(e.style.display="flex",e.style.flexDirection="row",e.style.justifyContent="flex-start",e.style.alignItems="center",e.querySelectorAll("li").forEach((e,s)=>{e.style.listStyleType="none",e.style.margin="0 10px",e.addEventListener("click",()=>{t.forEach((t,e)=>{t.style.display=e==s?"block":"none"})})}))},addPresentationStyles(){const t=this.$refs["a-preview"].shadowRoot.querySelectorAll(".slide");t.forEach((t,e)=>{t.style.padding="16px",t.style.margin="20px",t.style.width="calc(100% - 72px)",t.style.boxShadow="0px 0px 10px rgba(0, 0, 0, 0.1)",t.style.borderRadius="8px"})}},watch:{"$store.state.attachment.selectedAttachment":function(){0!==Object.keys(this.$store.state.attachment.selectedAttachment).length&&(this.attachment=this.$store.state.attachment.selectedAttachment,this.getPreview())}}},z=I,N=(s("0936"),Object($["a"])(z,P,F,!1,null,"793ffaf9",null)),M=N.exports,B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"attachment-edit"}},[s("div",{staticClass:"editable-data"},[s("h2",[t._v(t._s(t.attachment.value))]),s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"description"}},[t._v(t._s(t.$t("attachments.desc"))+" ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.attachment.description,expression:"attachment.description"}],attrs:{name:"description",type:"text"},domProps:{value:t.attachment.description},on:{input:function(e){e.target.composing||t.$set(t.attachment,"description",e.target.value)}}})]),s("div",{staticClass:"input-group"},[s("label",{attrs:{for:"status"}},[t._v(t._s(t.$t("attachments.status")))]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.attachment.is_validated,expression:"attachment.is_validated"}],attrs:{name:"status"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.attachment,"is_validated",e.target.multiple?s:s[0])}}},[s("option",{attrs:{value:"0"}},[t._v("Indéfini")]),s("option",{attrs:{value:"1"}},[t._v("Validé")]),s("option",{attrs:{value:"-2"}},[t._v("Invalide")])])])]),s("div",{staticClass:"non-editable-data"},[s("div",[s("span",[t._v(t._s(t.$t("attachments.send_date")))]),s("span",[t._v(t._s(t.attachment.timedate))])]),s("div",[s("span",[t._v(t._s(t.$t("attachments.modified_by")))]),s("span",[t._v(t._s(t.attachment.modified_by))])]),s("div",[s("span",[t._v(t._s(t.$t("attachments.modification_date")))]),s("span",[t._v(t._s(t.attachment.modified))])]),s("div",[s("span",[t._v(t._s(t.$t("attachments.file_size")))]),s("span",[t._v(" ... kb ")])])]),s("div",{staticClass:"actions"},[s("button",{staticClass:"btn save-btn",on:{click:t.saveChanges}},[t._v(t._s(t.$t("save")))])])])},L=[],q={name:"AttachmentEdit",props:{fnum:{type:String,required:!0}},data(){return{attachment:{}}},mounted(){this.attachment=this.$store.state.attachment.selectedAttachment},methods:{async saveChanges(){const t={id:this.attachment.aid,description:this.attachment.description,is_validated:this.attachment.is_validated},e=await D.updateAttachment(this.fnum,this.$store.state.user.currentUser,t);e.status&&this.$store.commit("attachment/updateAttachmentOfFnum",{fnum:this.fnum,attachment:this.attachment}),this.$emit("saveChanges",t)}},watch:{"$store.state.attachment.selectedAttachment":function(){0!==Object.keys(this.$store.state.attachment.selectedAttachment).length&&(this.attachment=this.$store.state.attachment.selectedAttachment)}}},Y=q,R=(s("d7c4"),Object($["a"])(Y,B,L,!1,null,"701daf01",null)),X=R.exports,V={async getUsers(){try{const t=await J().get("index.php?option=com_emundus&controller=users&task=getusers");return t.data}catch(t){throw t}},async getCurrentUser(){try{const t=await J().get("index.php?option=com_emundus&controller=users&task=getuser");return t.data}catch(t){throw new Error(t)}},async getUserById(t){try{const e=await J().get("index.php?option=com_emundus&controller=users&task=getuserbyid",{params:{id:t}});return e.data}catch(e){throw new Error(e)}}},H={async getFnums(){try{const t=await J().get("index.php?option=com_emundus&controller=files&task=getallfnums");return t.data}catch(t){console.error(t)}},async getFnumInfos(t){try{const e=await J().get("index.php?option=com_emundus&controller=files&task=getfnuminfos",{params:{fnum:t}});return e.data}catch(e){console.log(e)}}},W=s("4e22"),G=s.n(W),K={name:"Attachments",components:{AttachmentPreview:M,AttachmentEdit:X},props:{user:{type:String,required:!0},fnum:{type:String,required:!0}},data(){return{loading:!0,attachments:[],fnums:[],users:{},displayedUser:{},displayedFnum:this.fnum,checkedAttachments:[],selectedAttachment:{},lastSort:""}},mounted(){this.getFnums(),this.getUsers(),this.getAttachments()},destroyed(){this.$router.push({name:"app"})},methods:{async getFnums(){this.fnums=await H.getFnums(this.user)},async getUsers(){this.users=await V.getUsers(),this.$store.dispatch("user/setUsers",this.users),this.$store.dispatch("user/setCurrentUser",this.user),this.setDisplayedUser()},async setDisplayedUser(){const t=await H.getFnumInfos(this.displayedFnum);this.displayedUser=this.users.find(e=>e.id==t.fnumInfos.applicant_id),this.$store.dispatch("user/setDisplayedUser",this.displayedUser.id)},async getAttachments(){this.$store.state.attachment.attachments[this.displayedFnum]?this.attachments=this.$store.state.attachment.attachments[this.displayedFnum]:(this.loading=!0,this.attachments=await D.getAttachmentsByFnum(this.displayedFnum),this.$store.dispatch("attachment/setAttachmentsOfFnum",{fnum:[this.displayedFnum],attachments:this.attachments})),this.loading=!1},updateAttachment(){this.getAttachments(),this.$modal.hide("edit"),this.selectedAttachment={}},async deleteAttachments(){this.attachments=this.attachments.filter(t=>!this.checkedAttachments.includes(t.aid));const t=await D.deleteAttachments(this.displayedFnum,this.checkedAttachments);t.status},prevFile(){this.displayedFnum=this.fnums[this.fnumPosition-1],this.setDisplayedUser(),this.getAttachments()},nextFile(){this.displayedFnum=this.fnums[this.fnumPosition+1],this.setDisplayedUser(),this.getAttachments()},prevAttachment(){this.selectedAttachment=this.displayedAttachments[this.selectedAttachmentPosition-1],this.$store.dispatch("attachment/setSelectedAttachment",this.selectedAttachment)},nextAttachment(){this.selectedAttachment=this.displayedAttachments[this.selectedAttachmentPosition+1],this.$store.dispatch("attachment/setSelectedAttachment",this.selectedAttachment)},searchInFiles(){this.attachments.forEach((t,e)=>{t.description.toLowerCase().includes(this.$refs["searchbar"].value.toLowerCase())||t.filename.toLowerCase().includes(this.$refs["searchbar"].value.toLowerCase())?this.attachments[e].show=!0:(this.checkedAttachments=this.checkedAttachments.filter(e=>e!==t.aid),this.attachments[e].show=!1)})},orderBy(t){this.lastSort==t?this.attachments.reverse():this.attachments.sort((e,s)=>e[t]<s[t]?-1:e[t]>s[t]?1:0),this.lastSort=t},updateAllCheckedAttachments(t){t.target.checked?this.checkedAttachments=this.displayedAttachments.map(t=>t.aid):this.checkedAttachments=[]},updateCheckedAttachments(t){this.checkedAttachments.contains(t)?this.checkedAttachments.splice(this.checkedAttachments.indexOf(t),1):this.checkedAttachments.push(t)},openModal(t){this.$modal.show("edit"),this.selectedAttachment=t,this.$store.dispatch("attachment/setSelectedAttachment",t)},closeModal(){this.$modal.hide("edit"),this.selectedAttachment={},this.$store.dispatch("attachment/setSelectedAttachment",{})},formattedTimeDate(t){return G()(t).format("DD/MM/YYYY")},userName(t){let e="";if(t&&t.length>0){const s=this.$store.state.user.users[t];s?e=s.firstname+" "+s.lastname:V.getUserById(t).then(s=>{s.status&&(e=s.user[0].firstname+" "+s.user[0].lastname,s.user[0].id=t,this.$store.dispatch("user/setUsers",s.user))})}return e}},computed:{displayedAttachments(){return this.attachments.filter(t=>1==t.show||void 0==t.show)},fnumPosition(){return this.fnums.indexOf(this.displayedFnum)},selectedAttachmentPosition(){return this.displayedAttachments.indexOf(this.selectedAttachment)},attachmentPath(){return this.$store.state.attachment.attachmentPath+this.displayedUser.id+"/"+this.selectedAttachment.filename}}},Q=K,Z=(s("5a46"),Object($["a"])(Q,S,U,!1,null,"33541bfd",null)),tt=Z.exports;function et(t){return{...t.params}}a["a"].use(g["a"]);var st=new g["a"]({routes:[{path:"/",name:"app",component:O},{path:"/attachments",name:"attachments",component:tt,props:t=>et(t)}]}),at={search:Joomla.JText._("SEARCH"),download:Joomla.JText._("LINK_TO_DOWNLOAD"),export:Joomla.JText._("EXPORT"),save:Joomla.JText._("SAVE"),attachments:{name:Joomla.JText._("NAME"),desc:Joomla.JText._("DESCRIPTION"),send_date:Joomla.JText._("SEND_DATE"),status:Joomla.JText._("STATUS"),modified_by:Joomla.JText._("MODIFIED_BY"),modification_date:Joomla.JText._("MODIFICATION_DATE"),validation_states:{"-2":Joomla.JText._("INVALID"),0:Joomla.JText._("WAITING"),1:Joomla.JText._("VALID")}}},nt=s("2726");a["a"].use(nt["a"]);var it=new nt["a"]({locale:"fr",fallbackLocale:"fr",messages:{fr:at,en:at}}),ct=s("209f"),rt=s.n(ct);a["a"].config.productionTip=!1,a["a"].use(b),a["a"].use(rt.a);let ot=!1,dt="",ht={},lt="";if(document.getElementById("em-application-attachment")){const t=document.getElementById("em-application-attachment");Array.prototype.slice.call(t.attributes).forEach((function(t){ht[t.name]=t.value})),lt="attachments",dt="#em-application-attachment",ot=!0}if(ot){const t=new a["a"]({el:dt,store:b,router:st,i18n:it,render(t){return t(O,{props:{componentName:lt,data:ht}})}});console.log("addEventListener"),window.addEventListener("destroy-com-emundus-vue",()=>{console.log("destroy-com-emundus-vue"),t.$destroy()})}},"5a46":function(t,e,s){"use strict";s("c8d4")},"5c0b":function(t,e,s){"use strict";s("6ace")},"6ace":function(t,e,s){},"91d0":function(t,e,s){},c8d4:function(t,e,s){},d7c4:function(t,e,s){"use strict";s("e060")},e060:function(t,e,s){}});
//# sourceMappingURL=app_emundus.js.map