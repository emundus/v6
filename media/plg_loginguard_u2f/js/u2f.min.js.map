{"version":3,"sources":["u2f.js"],"names":[],"mappings":"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","file":"u2f.min.js","sourcesContent":["/*!\n * @package   AkeebaLoginGuard\n * @copyright Copyright (c)2016-2021 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   GNU General Public License version 3, or later\n */\n\n// Namespace\nvar akeeba = akeeba || {};\n\nakeeba.LoginGuard = akeeba.LoginGuard || {};\n\nakeeba.LoginGuard.u2f = akeeba.LoginGuard.u2f || {\n    regData:       null,\n    authData:      null,\n    handlingError: false\n};\n\n/**\n * Register a new U2F security key.\n */\nakeeba.LoginGuard.u2f.setUp = function (e)\n{\n    e.preventDefault();\n\n    akeeba.LoginGuard.u2f.regData = Joomla.getOptions(\"akeeba.LoginGuard.u2f.regData\", [\"\", \"\"]);\n\n    var u2fRequest       = akeeba.LoginGuard.u2f.regData[0];\n    var u2fAuthorization = akeeba.LoginGuard.u2f.regData[1];\n\n    u2f.register(u2fRequest.appId, [u2fRequest], u2fAuthorization, akeeba.LoginGuard.u2f.setUpCallback);\n\n    return false;\n};\n\n/**\n * Callback for the U2F register() method\n *\n * @param   {u2f.RegisterResponse}  data\n */\nakeeba.LoginGuard.u2f.setUpCallback = function (data)\n{\n    if ((data.errorCode === undefined) || (data.errorCode === 0))\n    {\n        // Store the U2F reply\n        document.getElementById(\"loginguard-method-code\").value = JSON.stringify(data);\n\n        // Submit the form\n        document.forms[\"loginguard-method-edit\"].submit();\n\n        return;\n    }\n\n    akeeba.LoginGuard.u2f.showError(data.errorCode);\n};\n\n/**\n * Display an error when the U2F JS API responds with an errorCode\n *\n * @param   {int}  errorCode\n */\nakeeba.LoginGuard.u2f.showError = function (errorCode)\n{\n    /**\n     * Firefox sends two responses with error codes 4 and 1 when the device is already registered. Using this trick\n     * we only display the relevant error message (4), discarding the secondary generic error.\n     */\n    if (akeeba.LoginGuard.u2f.handlingError)\n    {\n        return;\n    }\n\n    akeeba.LoginGuard.u2f.handlingError = true;\n\n    switch (errorCode)\n    {\n        case 1:\n        default:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_OTHER\") + \" // \" + errorCode);\n            break;\n\n        case 2:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_CANNOTPROCESS\"));\n            break;\n\n        case 3:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_CLIENTCONFIGNOTSUPPORTED\"));\n            break;\n\n        case 4:\n            if (Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_INELIGIBLE_SIGN\") != \"\")\n            {\n                alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_INELIGIBLE_SIGN\"));\n\n                break;\n            }\n\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_INELIGIBLE\"));\n            break;\n\n        case 5:\n            alert(Joomla.JText._(\"PLG_LOGINGUARD_U2F_ERR_JS_TIMEOUT\"));\n\n            break;\n    }\n\n    try\n    {\n        document.getElementById('loginguard-captive-button-submit').style.disabled = null;\n    }\n    catch (e)\n    {\n    }\n\n    akeeba.LoginGuard.u2f.handlingError = false;\n};\n\n/**\n * Ask the U2F key to sign a challenge (validation)\n */\nakeeba.LoginGuard.u2f.validate = function ()\n{\n    // This line was valid for U2F Javascript API 1.0 which is no longer supported ;(\n    // u2f.sign(akeeba.LoginGuard.u2f.authData, akeeba.LoginGuard.u2f.validateCallback);\n\n    akeeba.LoginGuard.u2f.authData = Joomla.getOptions(\"akeeba.LoginGuard.u2f.authData\", [\"\", \"\"]);\n\n    u2f.sign(\n        akeeba.LoginGuard.u2f.authData[0].appId, akeeba.LoginGuard.u2f.authData[0].challenge,\n        akeeba.LoginGuard.u2f.authData, akeeba.LoginGuard.u2f.validateCallback\n    );\n};\n\n/**\n * Callback for the U2F sign() method\n *\n * @param   {u2f.SignResponse}  response\n */\nakeeba.LoginGuard.u2f.validateCallback = function (response)\n{\n    if ((response.errorCode === undefined) || (response.errorCode === 0))\n    {\n        document.getElementById(\"loginGuardCode\").value = JSON.stringify(response);\n        document.forms[\"loginguard-captive-form\"].submit();\n\n        return;\n    }\n\n    akeeba.LoginGuard.u2f.showError(response.errorCode);\n};\n\nwindow.addEventListener(\"DOMContentLoaded\", function (event)\n{\n    document.querySelectorAll(\".loginguard_u2f_setup\")\n            .forEach(function (elButton)\n            {\n                elButton.addEventListener('click', akeeba.LoginGuard.u2f.setUp);\n            });\n});\n"]}