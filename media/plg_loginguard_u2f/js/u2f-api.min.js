'use strict';(function(){var a="chrome"in window&&0>window.navigator.userAgent.indexOf("Edge");if(!("u2f"in window)&&a){var b,c=window.u2f={};c.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd",c.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_SIGN_RESPONSE:"u2f_sign_response",U2F_GET_API_VERSION_REQUEST:"u2f_get_api_version_request",U2F_GET_API_VERSION_RESPONSE:"u2f_get_api_version_response"},c.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5},c.U2fRequest,c.U2fResponse,c.Error,c.Transport,c.Transports,c.SignRequest,c.SignResponse,c.RegisterRequest,c.RegisterResponse,c.RegisteredKey,c.GetJsApiVersionResponse,c.getMessagePort=function(a){if("undefined"!=typeof chrome&&chrome.runtime){var b={type:c.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]};chrome.runtime.sendMessage(c.EXTENSION_ID,b,function(){chrome.runtime.lastError?c.getIframePort_(a):c.getChromeRuntimePort_(a)})}else c.isAndroidChrome_()?c.getAuthenticatorPort_(a):c.isIosChrome_()?c.getIosPort_(a):c.getIframePort_(a)},c.isAndroidChrome_=function(){var a=navigator.userAgent;return-1!=a.indexOf("Chrome")&&-1!=a.indexOf("Android")},c.isIosChrome_=function(){return-1<["iPhone","iPad","iPod"].indexOf(navigator.platform)},c.getChromeRuntimePort_=function(a){var b=chrome.runtime.connect(c.EXTENSION_ID,{includeTlsChannelId:!0});setTimeout(function(){a(new c.WrappedChromeRuntimePort_(b))},0)},c.getAuthenticatorPort_=function(a){setTimeout(function(){a(new c.WrappedAuthenticatorPort_)},0)},c.getIosPort_=function(a){setTimeout(function(){a(new c.WrappedIosPort_)},0)},c.WrappedChromeRuntimePort_=function(a){this.port_=a},c.formatSignRequest_=function(a,d,e,f,g){if(void 0===b||1.1>b){for(var h=[],j=0;j<e.length;j++)h[j]={version:e[j].version,challenge:d,keyHandle:e[j].keyHandle,appId:a};return{type:c.MessageTypes.U2F_SIGN_REQUEST,signRequests:h,timeoutSeconds:f,requestId:g}}return{type:c.MessageTypes.U2F_SIGN_REQUEST,appId:a,challenge:d,registeredKeys:e,timeoutSeconds:f,requestId:g}},c.formatRegisterRequest_=function(a,d,e,f,g){if(void 0===b||1.1>b){for(var h=0;h<e.length;h++)e[h].appId=a;for(var j=[],h=0;h<d.length;h++)j[h]={version:d[h].version,challenge:e[0],keyHandle:d[h].keyHandle,appId:a};return{type:c.MessageTypes.U2F_REGISTER_REQUEST,signRequests:j,registerRequests:e,timeoutSeconds:f,requestId:g}}return{type:c.MessageTypes.U2F_REGISTER_REQUEST,appId:a,registerRequests:e,registeredKeys:d,timeoutSeconds:f,requestId:g}},c.WrappedChromeRuntimePort_.prototype.postMessage=function(a){this.port_.postMessage(a)},c.WrappedChromeRuntimePort_.prototype.addEventListener=function(a,b){var c=a.toLowerCase();"message"==c||"onmessage"==c?this.port_.onMessage.addListener(function(a){b({data:a})}):console.error("WrappedChromeRuntimePort only supports onMessage")},c.WrappedAuthenticatorPort_=function(){this.requestId_=-1,this.requestObject_=null},c.WrappedAuthenticatorPort_.prototype.postMessage=function(a){var b=c.WrappedAuthenticatorPort_.INTENT_URL_BASE_+";S.request="+encodeURIComponent(JSON.stringify(a))+";end";document.location=b},c.WrappedAuthenticatorPort_.prototype.getPortType=function(){return"WrappedAuthenticatorPort_"},c.WrappedAuthenticatorPort_.prototype.addEventListener=function(a,b){var c=a.toLowerCase();if("message"==c){var d=this;window.addEventListener("message",d.onRequestUpdate_.bind(d,b),!1)}else console.error("WrappedAuthenticatorPort only supports message")},c.WrappedAuthenticatorPort_.prototype.onRequestUpdate_=function(a,b){var c=JSON.parse(b.data),d=c.intentURL,e=c.errorCode,f=null;c.hasOwnProperty("data")&&(f=JSON.parse(c.data)),a({data:f})},c.WrappedAuthenticatorPort_.INTENT_URL_BASE_="intent:#Intent;action=com.google.android.apps.authenticator.AUTHENTICATE",c.WrappedIosPort_=function(){},c.WrappedIosPort_.prototype.postMessage=function(a){var b=JSON.stringify(a),c="u2f://auth?"+encodeURI(b);location.replace(c)},c.WrappedIosPort_.prototype.getPortType=function(){return"WrappedIosPort_"},c.WrappedIosPort_.prototype.addEventListener=function(a){var b=a.toLowerCase();"message"!==b&&console.error("WrappedIosPort only supports message")},c.getIframePort_=function(a){var b="chrome-extension://"+c.EXTENSION_ID,d=document.createElement("iframe");d.src=b+"/u2f-comms.html",d.setAttribute("style","display:none"),document.body.appendChild(d);var e=new MessageChannel,f=function(b){"ready"==b.data?(e.port1.removeEventListener("message",f),a(e.port1)):console.error("First event on iframe port was not \"ready\"")};e.port1.addEventListener("message",f),e.port1.start(),d.addEventListener("load",function(){d.contentWindow.postMessage("init",b,[e.port2])})},c.EXTENSION_TIMEOUT_SEC=30,c.port_=null,c.waitingForPort_=[],c.reqCounter_=0,c.callbackMap_={},c.getPortSingleton_=function(a){c.port_?a(c.port_):(0==c.waitingForPort_.length&&c.getMessagePort(function(a){for(c.port_=a,c.port_.addEventListener("message",c.responseHandler_);c.waitingForPort_.length;)c.waitingForPort_.shift()(c.port_)}),c.waitingForPort_.push(a))},c.responseHandler_=function(a){var b=a.data,d=b.requestId;if(!d||!c.callbackMap_[d])return void console.error("Unknown or missing requestId in response.");var e=c.callbackMap_[d];delete c.callbackMap_[d],e(b.responseData)},c.sign=function(a,d,e,f,g){void 0===b?c.getApiVersion(function(h){b=void 0===h.js_api_version?0:h.js_api_version,console.log("Extension JS API Version: ",b),c.sendSignRequest(a,d,e,f,g)}):c.sendSignRequest(a,d,e,f,g)},c.sendSignRequest=function(a,b,d,e,f){c.getPortSingleton_(function(g){var h=++c.reqCounter_;c.callbackMap_[h]=e;var i="undefined"==typeof f?c.EXTENSION_TIMEOUT_SEC:f,j=c.formatSignRequest_(a,b,d,i,h);g.postMessage(j)})},c.register=function(a,d,e,f,g){void 0===b?c.getApiVersion(function(h){b=void 0===h.js_api_version?0:h.js_api_version,console.log("Extension JS API Version: ",b),c.sendRegisterRequest(a,d,e,f,g)}):c.sendRegisterRequest(a,d,e,f,g)},c.sendRegisterRequest=function(a,b,d,e,f){c.getPortSingleton_(function(g){var h=++c.reqCounter_;c.callbackMap_[h]=e;var i="undefined"==typeof f?c.EXTENSION_TIMEOUT_SEC:f,j=c.formatRegisterRequest_(a,d,b,i,h);g.postMessage(j)})},c.getApiVersion=function(a,b){c.getPortSingleton_(function(d){if(d.getPortType){var e;switch(d.getPortType()){case"WrappedIosPort_":case"WrappedAuthenticatorPort_":e=1.1;break;default:e=0;}return void a({js_api_version:e})}var f=++c.reqCounter_;c.callbackMap_[f]=a;var g={type:c.MessageTypes.U2F_GET_API_VERSION_REQUEST,timeoutSeconds:"undefined"==typeof b?c.EXTENSION_TIMEOUT_SEC:b,requestId:f};d.postMessage(g)})}}})();

//# sourceMappingURL=u2f-api.min.js.map