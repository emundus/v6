/*! Fabrik */

define(["jquery"],function(t){return new Class({Implements:[Events,Options],options:{requireChecked:!0,canAJAX:!0},initialize:function(t){if(this.setOptions(t),this.result=!0,"null"!==typeOf(this.getList())){if("function"==typeof this.getList().getForm){this.listform=this.getList().getForm();var i=this.listform.getElement("input[name=listid]");if("null"===typeOf(i))return;this.listid=i.value}else this.listform=this.getList().container.getElement("form");this.watchButton()}},getList:function(){var t=Fabrik.blocks["list_"+this.options.ref];return"null"===typeOf(t)&&(t=Fabrik.blocks["visualization_"+this.options.ref]),t},getRowId:function(t){return t.hasClass("fabrik_row")||(t=t.getParent(".fabrik_row")),t.id.split("_").getLast()},clearFilter:Function.from(),watchButton:function(){"null"!==typeOf(this.options.name)&&document.addEvent("click:relay(."+this.options.name+")",function(t,i){if(!t.rightClick&&(t.stop(),i.get("data-list")===this.list.options.listRef)){var e,n;t.preventDefault(),t.target.getParent(".fabrik_row")&&(e=t.target.getParent(".fabrik_row")).getElement("input[name^=ids]")&&(n=e.getElement("input[name^=ids]"),this.listform.getElements("input[name^=ids]").set("checked",!1),n.set("checked",!0));var s=!1;if(this.listform.getElements("input[name^=ids]").each(function(t){t.checked&&(s=!0)}),s||!this.options.requireChecked){var o=this.options.name.split("-");this.listform.getElement("input[name=fabrik_listplugin_name]").value=o[0],this.listform.getElement("input[name=fabrik_listplugin_renderOrder]").value=o.getLast(),this.buttonAction()}else alert(Joomla.JText._("COM_FABRIK_PLEASE_SELECT_A_ROW"))}}.bind(this))},buttonAction:function(){var t=this.options.canAJAX?"list.doPlugin":"list.doPlugin.noAJAX";this.list.submit(t)}})});