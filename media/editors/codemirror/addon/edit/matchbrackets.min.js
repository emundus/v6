!(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})((function(a){function b(a){return a&&a.bracketRegex||/[(){}[\]]/}function c(a,c,e){var f=a.getLineHandle(c.line),g=c.ch-1,j=e&&e.afterCursor;null==j&&(j=/(^| )cm-fat-cursor($| )/.test(a.getWrapperElement().className));var k=b(e),l=!j&&g>=0&&k.test(f.text.charAt(g))&&i[f.text.charAt(g)]||k.test(f.text.charAt(g+1))&&i[f.text.charAt(++g)];if(!l)return null;var m=">"==l.charAt(1)?1:-1;if(e&&e.strict&&m>0!=(g==c.ch))return null;var n=a.getTokenTypeAt(h(c.line,g+1)),o=d(a,h(c.line,g+(m>0?1:0)),m,n||null,e);return null==o?null:{from:h(c.line,g),to:o&&o.pos,match:o&&o.ch==l.charAt(0),forward:m>0}}function d(a,c,d,e,f){for(var g=f&&f.maxScanLineLength||1e4,j=f&&f.maxScanLines||1e3,k=[],l=b(f),m=d>0?Math.min(c.line+j,a.lastLine()+1):Math.max(a.firstLine()-1,c.line-j),n=c.line;n!=m;n+=d){var o=a.getLine(n);if(o){var p=d>0?0:o.length-1,q=d>0?o.length:-1;if(!(o.length>g))for(n==c.line&&(p=c.ch-(d<0?1:0));p!=q;p+=d){var r=o.charAt(p);if(l.test(r)&&(void 0===e||a.getTokenTypeAt(h(n,p+1))==e)){var s=i[r];if(s&&">"==s.charAt(1)==d>0)k.push(r);else{if(!k.length)return{pos:h(n,p),ch:r};k.pop()}}}}}return n-d!=(d>0?a.lastLine():a.firstLine())&&null}function e(a,b,d){for(var e=a.state.matchBrackets.maxHighlightLineLength||1e3,f=[],i=a.listSelections(),j=0;j<i.length;j++){var k=i[j].empty()&&c(a,i[j].head,d);if(k&&a.getLine(k.from.line).length<=e){var l=k.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";f.push(a.markText(k.from,h(k.from.line,k.from.ch+1),{className:l})),k.to&&a.getLine(k.to.line).length<=e&&f.push(a.markText(k.to,h(k.to.line,k.to.ch+1),{className:l}))}}if(f.length){g&&a.state.focused&&a.focus();var m=function(){a.operation((function(){for(var a=0;a<f.length;a++)f[a].clear()}))};if(!b)return m;setTimeout(m,800)}}function f(a){a.operation((function(){a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=null),a.state.matchBrackets.currentlyHighlighted=e(a,!1,a.state.matchBrackets)}))}var g=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),h=a.Pos,i={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};a.defineOption("matchBrackets",!1,(function(b,c,d){function e(a){a.state.matchBrackets&&a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=null)}d&&d!=a.Init&&(b.off("cursorActivity",f),b.off("focus",f),b.off("blur",e),e(b)),c&&(b.state.matchBrackets="object"==typeof c?c:{},b.on("cursorActivity",f),b.on("focus",f),b.on("blur",e))})),a.defineExtension("matchBrackets",(function(){e(this,!0)})),a.defineExtension("findMatchingBracket",(function(a,b,d){return(d||"boolean"==typeof b)&&(d?(d.strict=b,b=d):b=b?{strict:!0}:null),c(this,a,b)})),a.defineExtension("scanForBracket",(function(a,b,c,e){return d(this,a,b,c,e)}))}));