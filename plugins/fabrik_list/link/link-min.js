/*! Fabrik */

define(["jquery","fab/list-plugin"],function(e,t){return new Class({Extends:t,options:{link:"",fabrikLink:!1,newTab:!1,windowTitle:""},initialize:function(t){this.parent(t)},buttonAction:function(){var t=this.list.getForm().getElements("input[name^=ids]").filter(function(t){return t.checked}),i=t.map(function(t){return t.get("value")}),n={};if(t.each(function(t){var i=t.get("value");n[i]=this.list.getRow(i)}.bind(this)),""!==this.options.link){e.each(Fabrik.Windows,function(t,i){t.test(/^custom\./)&&i.close()});var o=this.options.link;if(e.each(n[i[0]],function(t,i){"__pk_val"===t&&(t="rowid");var n=new RegExp("{"+t+"}","g");o=o.replace(n,i)}),this.options.fabrikLink){o+=o.contains("?")?"&":"?",o+="tmpl=component&ajax=1",o+="&format=partial";var s={id:"custom."+this.list.id,title:this.options.windowTitle,loadMethod:"xhr",contentURL:o,width:this.list.options.popup_width,height:this.list.options.popup_height};null!==this.list.options.popup_offset_x&&(s.offset_x=this.list.options.popup_offset_x),null!==this.list.options.popup_offset_y&&(s.offset_y=this.options.popup_offset_y),Fabrik.getWindow(s)}else this.options.newTab?window.open(o,"_blank"):window.location=o}}})});