/*! Fabrik */

define(["jquery","fab/fabrik"],function(n,e){"use strict";return new Class({options:{renderOrder:""},initialize:function(t){if(!t.editable){this.options=n.extend(this.options,t),this.form=e.getBlock("details_"+this.options.formid),this.watchButtons()}},updateForm:function(t){""===t.err?(n(".zoomAttendingError").addClass("fabrikHide"),this.options.attending?(n("button.zoomAttending").parent().addClass("fabrikHide"),n(".zoomOptInNotConfirmed").parent().removeClass("fabrikHide"),this.options.attending=!1):(n("button.zoomAttending").parent().removeClass("fabrikHide"),n(".zoomOptInNotConfirmed").parent().addClass("fabrikHide"),this.options.attending=!0)):(n(".zoomAttendingError").html("<p>"+t.err+"</p>"),n(".zoomAttendingError").removeClass("fabrikHide"))},doConfirm:function(t){n(".zoomOptInNotConfirmed").addClass("fabrikHide"),n(".zoomOptIn").removeClass("fabrikHide")},doCancel:function(t){n(".zoomOptIn").addClass("fabrikHide"),n(".zoomOptInNotConfirmed").removeClass("fabrikHide")},doAttending:function(t){var o=t.get("data-attending"),i=this;e.loader.start(this.form.getBlock()),n.ajax({url:e.liveSite+"index.php",method:"post",dataType:"json",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"zoom",method:"ajax_attending",userId:this.options.userId,thingId:this.options.thingId,zoomId:this.options.zoomId,attending:o,g:"form",formid:this.options.formid,renderOrder:this.options.renderOrder}}).always(function(){e.loader.stop(i.form.getBlock())}).fail(function(t,o,i){window.alert(o)}).done(function(t){i.updateForm(t)})},watchButtons:function(){var t=this.form.getForm();t.addEvent("click:relay(.zoomNotAttending)",function(t,o){t.preventDefault(),this.doConfirm(o)}.bind(this)),t.addEvent("click:relay(.zoomOptInCancel)",function(t,o){t.preventDefault(),this.doCancel(o)}.bind(this)),t.addEvent("click:relay(*[data-attending])",function(t,o){t.preventDefault(),this.doAttending(o)}.bind(this))}})});