/*! Fabrik */

define(["jquery","fab/fabrik"],function(o,a){"use strict";return new Class({initialize:function(i,t){this.form=i,this.options={liveSite:""},this.options=o.extend(this.options,t);var s=this.form.getForm(),e=this.form.id;this.pkfield=s.getElement("input[name=rowid]"),this.view=!0===this.form.options.editable?"form":"details",this.url=this.options.liveSite+"index.php?option=com_fabrik&format=raw&view=plugin&g=form&task=pluginAjax&plugin=paginate&method=xRecord&formid="+e+"&mode="+this.options.view+"&rowid=",this.watchButtons()},doUpdate:function(i){var s,e=JSON.parse(i),o="form"===this.view?e.data:e.html;this.options.ids=e.ids,this.form.formElements.each(function(t,i){if("_ro"!==i.substr(-3)){s=o[i];try{"null"!==typeOf(s)?t.updateUsingRaw()?t.update(e.data[i]):"form"===this.view?t.update(s):t.update(Encoder.htmlDecode(s)):t.update("")}catch(i){console.log(t,s,i)}}}.bind(this)),"form"===this.view&&(this.pkfield.value=o[this.options.pkey]),this.form.options.rowid=e.data[this.options.pkey],this.reScan(),window.fireEvent("fabrik.form.refresh",[e.post.rowid]),a.loader.stop(this.form.getBlock())},reScan:function(){"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage(),this.form.getForm().getElements("*[data-paginate]").each(function(i){switch(i.get("data-paginate")){case"first":case"prev":0===this.options.ids.index?i.addClass("active"):i.removeClass("active");break;case"next":case"last":this.options.ids.index===this.options.ids.lastKey?i.addClass("active"):i.removeClass("active")}}.bind(this))},doNav:function(i){var t,s=!0;switch(i.get("data-paginate")){case"first":0===this.options.ids.index&&(s=!1),t=this.options.ids.first;break;case"last":this.options.ids.index===this.options.ids.lastKey&&(s=!1),t=this.options.ids.last;break;case"prev":0===this.options.ids.index&&(s=!1),t=this.options.ids.prev;break;case"next":this.options.ids.index===this.options.ids.lastKey&&(s=!1),t=this.options.ids.next}if(s){a.loader.start(this.form.getBlock());new Request({url:this.url+t,evalScripts:!0,onComplete:function(i){this.doUpdate(i)}.bind(this)}).send()}},watchButtons:function(){this.form.getForm().addEvent("click:relay(*[data-paginate])",function(i,t){i.preventDefault(),this.doNav(t)}.bind(this))}})});