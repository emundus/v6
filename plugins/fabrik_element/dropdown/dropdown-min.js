/*! Fabrik */

define(["jquery","fab/element"],function(s,t){return window.FbDropdown=new Class({Extends:t,initialize:function(t,e){this.setPlugin("fabrikdropdown"),this.parent(t,e),!0===this.options.allowadd&&!1!==this.options.editable&&(this.watchAddToggle(),this.watchAdd())},watchAddToggle:function(){var t=this.getContainer(),e=t.getElement("div.addoption"),i=t.getElement(".toggle-addoption");if(this.mySlider){var n=e.clone(),d=t.getElement(".fabrikElement");e.getParent().destroy(),d.adopt(n),(e=t.getElement("div.addoption")).setStyle("margin",0);var l=e.getElement("input[name*=_additions]");l.id=this.element.id+"_additions",l.name=this.element.id+"_additions"}this.mySlider=new Fx.Slide(e,{duration:500}),this.mySlider.hide(),i.addEvent("click",function(t){t.stop(),this.mySlider.toggle()}.bind(this))},addClick:function(t){var e,i=this.getContainer(),n=i.getElement("input[name=addPicklistLabel]"),d=i.getElement("input[name=addPicklistValue]"),l=n.value;if(""===(e=d?d.value:l)||""===l)window.alert(Joomla.JText._("PLG_ELEMENT_DROPDOWN_ENTER_VALUE_LABEL"));else{new Element("option",{selected:"selected",value:e}).set("text",l).inject(document.id(this.element.id));t.stop(),d&&(d.value=""),n.value="",this.addNewOption(e,l),document.id(this.element.id).fireEvent("change",{stop:function(){}}),this.mySlider&&this.mySlider.toggle(),this.options.advanced&&s("#"+this.element.id).trigger("liszt:updated")}},watchAdd:function(){if(!0===this.options.allowadd&&!1!==this.options.editable){this.element.id;var t=this.getContainer();this.addClickEvent&&t.getElement("input[type=button]").removeEvent("click",this.addClickEvent),this.addClickEvent=this.addClick.bind(this),t.getElement("input[type=button]").addEvent("click",this.addClickEvent)}},getValue:function(){if(!this.options.editable)return this.options.multiple?this.options.value:this.options.value[0];if("null"===typeOf(this.element.get("value")))return"";if(this.options.multiple){var e=[];return this.element.getElements("option").each(function(t){t.selected&&e.push(t.value)}),e}return this.element.get("value")},reset:function(){var t=this.options.defaultVal;this.update(t)},update:function(t){var e=[];if("string"===typeOf(t)&&""===t&&(t="[]"),"string"===typeOf(t)&&JSON.validate(t)&&(t=JSON.parse(t)),"null"===typeOf(t)&&(t=[]),this.getElement(),"null"!==typeOf(this.element))if(this.options.element=this.element.id,this.options.editable){e=this.element.getElements("option"),"number"===typeOf(t)&&(t=t.toString());for(var i=0;i<e.length;i++)-1!==t.indexOf(e[i].value)?e[i].selected=!0:e[i].selected=!1;this.options.advanced&&s("#"+this.element.id).trigger("liszt:updated"),this.watchAdd()}else{this.element.set("html","");var n=$H(this.options.data);t.each(function(t){this.element.innerHTML+=n.get(t)+"<br />"}.bind(this))}},cloned:function(t){!0===this.options.allowadd&&!1!==this.options.editable&&(this.watchAddToggle(),this.watchAdd()),this.parent(t)}}),window.FbDropdown});