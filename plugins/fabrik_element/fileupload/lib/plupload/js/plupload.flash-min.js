/*! Fabrik */

!function(e,d,u,t){var g={},c={};u.flash={trigger:function(t,i,s){setTimeout(function(){var e=g[t];e&&e.trigger("Flash:"+i,s)},0)}},u.runtimes.Flash=u.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(l,t){var e,i,s,n=0,a=d.body;(function(){var t;try{t=(t=navigator.plugins["Shockwave Flash"]).description}catch(e){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(e){t="0.0"}}return t=t.match(/\d+/g),parseFloat(t[0]+"."+t[1])})()<10?t({success:!1}):(c[l.id]=!1,g[l.id]=l,d.getElementById(l.settings.browse_button),(e=d.createElement("div")).id=l.id+"_flash_container",u.extend(e.style,{position:"absolute",top:"0px",background:l.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),e.className="plupload flash",l.settings.container&&(a=d.getElementById(l.settings.container),"static"===u.getStyle(a,"position")&&(a.style.position="relative")),a.appendChild(e),i='<object id="'+l.id+'_flash" type="application/x-shockwave-flash" data="'+l.settings.flash_swf_url+'" ',u.ua.ie&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+l.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(l.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',u.ua.ie?(s=d.createElement("div"),e.appendChild(s),s.outerHTML=i,s=null):e.innerHTML=i,function e(){5e3<n++?t({success:!1}):c[l.id]||setTimeout(e,1)}(),e=null,l.bind("Flash:Init",function(){var r={};o().setFileFilters(l.settings.filters,l.settings.multi_selection),c[l.id]||(c[l.id]=!0,l.bind("UploadFile",function(e,t){var i=e.settings,s=l.settings.resize||{};o().uploadFile(r[t.id],i.url,{name:t.target_name||t.name,mime:u.mimeTypes[t.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:i.chunk_size,width:s.width,height:s.height,quality:s.quality,multipart:i.multipart,multipart_params:i.multipart_params||{},file_data_name:i.file_data_name,format:/\.(jpg|jpeg)$/i.test(t.name)?"jpg":"png",headers:i.headers,urlstream_upload:i.urlstream_upload})}),l.bind("Flash:UploadProcess",function(e,t){var i=e.getFile(r[t.id]);i.status!=u.FAILED&&(i.loaded=t.loaded,i.size=t.size,e.trigger("UploadProgress",i))}),l.bind("Flash:UploadChunkComplete",function(e,t){var i,s=e.getFile(r[t.id]);i={chunk:t.chunk,chunks:t.chunks,response:t.text},e.trigger("ChunkUploaded",s,i),s.status!=u.FAILED&&o().uploadNextChunk(),t.chunk==t.chunks-1&&(s.status=u.DONE,e.trigger("FileUploaded",s,{response:t.text}))}),l.bind("Flash:SelectFiles",function(e,t){var i,s,n,a=[];for(s=0;s<t.length;s++)i=t[s],n=u.guid(),r[n]=i.id,r[i.id]=n,a.push(new u.File(n,i.name,i.size));a.length&&l.trigger("FilesAdded",a)}),l.bind("Flash:SecurityError",function(e,t){l.trigger("Error",{code:u.SECURITY_ERROR,message:u.translate("Security error."),details:t.message,file:l.getFile(r[t.id])})}),l.bind("Flash:GenericError",function(e,t){l.trigger("Error",{code:u.GENERIC_ERROR,message:u.translate("Generic error."),details:t.message,file:l.getFile(r[t.id])})}),l.bind("Flash:IOError",function(e,t){l.trigger("Error",{code:u.IO_ERROR,message:u.translate("IO error."),details:t.message,file:l.getFile(r[t.id])})}),l.bind("Flash:ImageError",function(e,t){l.trigger("Error",{code:parseInt(t.code,10),message:u.translate("Image error."),file:l.getFile(r[t.id])})}),l.bind("Flash:StageEvent:rollOver",function(e){var t,i;t=d.getElementById(l.settings.browse_button),i=e.settings.browse_button_hover,t&&i&&u.addClass(t,i)}),l.bind("Flash:StageEvent:rollOut",function(e){var t,i;t=d.getElementById(l.settings.browse_button),i=e.settings.browse_button_hover,t&&i&&u.removeClass(t,i)}),l.bind("Flash:StageEvent:mouseDown",function(e){var t,i;t=d.getElementById(l.settings.browse_button),i=e.settings.browse_button_active,t&&i&&(u.addClass(t,i),u.addEvent(d.body,"mouseup",function(){u.removeClass(t,i)},e.id))}),l.bind("Flash:StageEvent:mouseUp",function(e){var t,i;t=d.getElementById(l.settings.browse_button),i=e.settings.browse_button_active,t&&i&&u.removeClass(t,i)}),l.bind("Flash:ExifData",function(e,t){l.trigger("ExifData",l.getFile(r[t.id]),t.data)}),l.bind("Flash:GpsData",function(e,t){l.trigger("GpsData",l.getFile(r[t.id]),t.data)}),l.bind("QueueChanged",function(e){l.refresh()}),l.bind("FilesRemoved",function(e,t){var i;for(i=0;i<t.length;i++)o().removeFile(r[t[i].id])}),l.bind("StateChanged",function(e){l.refresh()}),l.bind("Refresh",function(e){var t,i,s;o().setFileFilters(l.settings.filters,l.settings.multi_selection),(t=d.getElementById(e.settings.browse_button))&&(i=u.getPos(t,d.getElementById(e.settings.container)),s=u.getSize(t),u.extend(d.getElementById(e.id+"_flash_container").style,{top:i.y+"px",left:i.x+"px",width:s.w+"px",height:s.h+"px"}))}),l.bind("Destroy",function(e){var t;u.removeAllEvents(d.body,e.id),delete c[e.id],delete g[e.id],(t=d.getElementById(e.id+"_flash_container"))&&a.removeChild(t)}),t({success:!0}))}));function o(){return d.getElementById(l.id+"_flash")}}})}(window,document,plupload);