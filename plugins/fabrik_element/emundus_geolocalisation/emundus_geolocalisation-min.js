define(["jquery","fab/element"],function(t,a){return window.FbEmundusGeolocation=new Class({Extends:a,mapContainer:null,mapLayer:null,initialize:function(t,a){if(this.setPlugin("emundus_geolocalisation"),this.parent(t,a),"undefined"!=typeof L&&null!==L){if(this.mapContainer=L.map(t+"___map_container").setView([a.default_lat,a.default_lng],a.default_zoom),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"\xa9 OpenStreetMap"}).addTo(this.mapContainer),this.mapLayer=L.layerGroup().addTo(this.mapContainer),this.mapContainer.on("click",this.updateMarkerPosition.bind(this)),a.value&&a.value.length>0){let e=a.value.split(",");this.updateMarkerPosition({latlng:{lat:e[0],lng:e[1]}})}else 1==a.get_location?navigator.geolocation.getCurrentPosition(t=>{this.updateMarkerPosition({latlng:{lat:t.coords.latitude,lng:t.coords.longitude}})},t=>{console.log(t),this.updateMarkerPosition({latlng:{lat:a.default_lat,lng:a.default_lng}})},{enableHighAccuracy:!1,timeout:5e3}):this.updateMarkerPosition({latlng:{lat:a.default_lat,lng:a.default_lng}})}},updateMarkerPosition:function(t){this.mapLayer.clearLayers(),this.mapLayer.addLayer(L.marker(t.latlng)),this.update(t.latlng.lat+","+t.latlng.lng),this.mapContainer.setView(t.latlng),Fabrik.fireEvent("fabrik.emundus_geolocalisation.update",[this,t.latlng.lat+","+t.latlng.lng])},updateZoom(t){t>0&&t<21&&this.mapContainer.setZoom(t)}}),window.FbEmundusGeolocation});