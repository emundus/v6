/*! Fabrik */

define(["jquery"],function(t){return new Class({options:{userid:0,mode:"",formid:0},Implements:[Events,Options],initialize:function(t,i){i.element=t,this.setOptions(i),!1!==this.options.canRate&&"creator-rating"!==this.options.mode&&(this.col=$$("."+t),this.origRating={},this.col.each(function(n){var s=n.getElements(".starRating");s.each(function(i){i.addEvent("mouseover",function(t){this.origRating[n.id]=i.getParent(".fabrikRating").getElement(".ratingScore").innerHTML.toInt(),s.each(function(t){this._getRating(i)>=this._getRating(t)?t.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):t.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this)),i.addEvent("mouseout",function(t){s.each(function(t){this.origRating[n.id]>=this._getRating(t)?t.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):t.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this))}.bind(this)),s.each(function(i){i.addEvent("click",function(t){this.doAjax(t,i)}.bind(this))}.bind(this))}.bind(this)))},_getRating:function(t){return t.get("data-rating").toInt()},doAjax:function(t,i){t.stop(),this.rating=this._getRating(i);var n=i.getParent(".fabrikRating");Fabrik.loader.start(n);var s=document.id(i).getParent(".fabrik_row").id.replace("list_"+this.options.listRef+"_row_",""),o={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"rating",g:"element",method:"ajax_rate",formid:this.options.formid,element_id:this.options.elid,row_id:s,elementname:this.options.elid,userid:this.options.userid,rating:this.rating,mode:this.options.mode};new Request({url:"",data:o,onComplete:function(t){this.rating=Math.round(parseFloat(t)),Fabrik.loader.stop(n),i.getParent(".fabrikRating").getElement(".ratingScore").set("html",t),i.getParent(".fabrikRating").getElements(".starRating").each(function(t){this.rating>=this._getRating(t)?t.removeClass(this.options.starIconEmpty).addClass(this.options.starIcon):t.addClass(this.options.starIconEmpty).removeClass(this.options.starIcon)}.bind(this))}.bind(this)}).send()}})});