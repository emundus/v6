define(["jquery","fab/element"],function(e,t){return window.FbCurrency=new Class({Extends:t,initialize:function(e,t){this.setPlugin("currency"),this.parent(e,t),this.HTMLInputElement=this.element.getElementById("currency_inputValue"),this.HTMLRowInputElement=this.element.getElementById("currency_rowInputValue"),this.HTMLSelectElement=this.element.getElementById("currency_selectValue"),this.idSelectedCurrency=this.options.idSelectedCurrency?this.options.idSelectedCurrency:0,this.allSelectedCurrencies=this.options.selectedCurrencies,this.initSelect(),this.addMask()},cloned:function(e){this.HTMLInputElement=this.element.getElementById("currency_inputValue"),this.HTMLRowInputElement=this.element.getElementById("currency_rowInputValue"),this.HTMLSelectElement=this.element.getElementById("currency_selectValue"),this.HTMLInputElement.removeAttribute("value"),this.mask=null,this.initSelect(),this.addMask(),this.parent(e)},initSelect:function(){if(1===this.HTMLSelectElement.options.length)this.HTMLSelectElement.setAttribute("tabindex",-1),this.HTMLSelectElement.style.pointerEvents="none",this.HTMLSelectElement.style.backgroundImage="none",this.HTMLSelectElement.style.textAlign="end",this.changeElement(this.HTMLSelectElement.options[0]);else{Fabrik.buildChosen(this.HTMLSelectElement,{disable_search_threshold:5,allow_single_deselect:!0,search_contains:!0});let t=document.querySelector("#"+this.element.id+" .chzn-single span");this.changeElement(t),e(this.HTMLSelectElement).on("change",()=>{this.handlerSelectChange()})}},handlerSelectChange:function(){let e=this.idSelectedCurrency,t=this.idSelectedCurrency=this.HTMLSelectElement.selectedIndex,n=this.getNewInputValue(this.HTMLInputElement.value,e,t);this.addMask(),this.mask.value=n;let l=document.querySelector("#"+this.element.id+" .chzn-single span");this.changeElement(l)},changeElement:function(e){let t=this.HTMLSelectElement,n=t.value,l=this.getSymbolFromIso3(n),i=document.querySelector("#"+this.element.id+' input[name="currency_displayiso3"]').value;1==i?e.textContent=l+" ("+n+")":e.textContent=l},getNewInputValue:function(e,t,n){let l=this.allSelectedCurrencies[t].decimal_separator,i=this.allSelectedCurrencies[t].thousand_separator,s=this.allSelectedCurrencies[n].decimal_separator,r=this.allSelectedCurrencies[n].thousand_separator;return e.replace(l,s).replace(i,r)},getSymbolFromIso3:function(e){let t;for(let n of this.options.allCurrency)n.iso3===e&&(t=n.symbol);return t},addMask:function(){this.mask&&this.mask.destroy(),this.mask=IMask(this.HTMLInputElement,{mask:Number,scale:this.allSelectedCurrencies[this.idSelectedCurrency].decimal_numbers,signed:!1,thousandsSeparator:this.allSelectedCurrencies[this.idSelectedCurrency].thousand_separator,padFractionalZeros:!1,normalizeZeros:!0,radix:this.allSelectedCurrencies[this.idSelectedCurrency].decimal_separator,min:this.allSelectedCurrencies[this.idSelectedCurrency].minimal_value,max:this.allSelectedCurrencies[this.idSelectedCurrency].maximal_value})},update:function(e){"null"!==typeOf(this.element)&&this.setValue(e)},getValue:function(){return this.mask.unmaskedValue},setValue:function(e){let t=this.allSelectedCurrencies[this.idSelectedCurrency].decimal_separator;this.mask.value=e.toString().replace(".",t)},updateUsingRaw:function(){return!0},onsubmit:function(e){this.HTMLRowInputElement.value=this.mask.unmaskedValue,this.parent(e)}}),window.FbCurrency});