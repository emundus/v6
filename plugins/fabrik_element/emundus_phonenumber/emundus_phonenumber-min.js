define(["jquery","fab/element"],function(e,t){return window.FbPhoneNumber=new Class({Extends:t,initialize:function(e,t){this.setPlugin("emundus_phonenumber"),this.parent(e,t),this.prepareCountryCode(),this.initChosen(),this.initValidatorJS()},cloned:function(e){this.element.getElementById("inputValue").value="",this.element.getElementById("countrySelect").setAttribute("selectedValue",this.options.allCountries[0].iso2),this.element.getElementById("countrySelect_chzn").remove(),this.initChosen(),this.initValidatorJS(!0),this.parent(e)},prepareCountryCode:function(){var t=e("#"+this.element.id+" #countrySelect option");for(let n of t)try{var i=libphonenumber.getCountryCallingCode(n.value);n.setAttribute("data-countrycode",i),n.textContent=n.textContent+" (+"+i+")"}catch(l){}},initChosen:function(){Fabrik.buildChosen("#"+this.element.id+" #countrySelect",{disable_search_threshold:10,allow_single_deselect:!0,search_contains:!0}),setTimeout(()=>{e("#"+this.element.id+" #countrySelect").trigger("liszt:updated"),this.watchChange(),document.querySelector("#"+this.element.id+" .chzn-container .chzn-drop").style.minWidth=document.getElementById(this.element.id).offsetWidth+"px",e("#"+this.element.id+" #countrySelect").on("change",()=>{this.watchChange()})},100)},initValidatorJS:function(e=!1){let t=this.element.getElementById("countrySelect"),n=this.element.getElementById("inputValue");if(null!==t&&null!==n){let i=this.options.allCountries,l,o=this.getSelectedCountryIndex(i,this.options.default_country);if(""!==t.getAttribute("selectedValue")){l=n.value;let s=t.getAttribute("selectedValue");o=this.getSelectedCountryIndex(i,s)}this.ValidatorJS=new ValidatorJS(this.element,i,o,l,e)}},watchChange:function(){var t="#"+this.element.id+" #countrySelect",n=e(t).val(),i=e(t+" option:selected").attr("data-flag");e(t+" option[data-value='selected']").attr("value",n),e(t+" option[data-value='selected']").html('<img src"images/emundus/'+i+'" alt="'+n+'"/>'),e(t).val(n),e("#"+this.element.id+" #countrySelect_chzn .chzn-single span").html("<img src='/images/emundus/flags/"+i+"' alt='"+n+"'/>")},getSelectedCountryIndex:function(e,t){let n=0;return null!=t&&""!==t&&(n=-1===(n=e.findIndex(e=>e.iso2===t))?0:n),n},getValue:function(){return this.element.getElementById("renderCountryCode").value+this.element.getElementById("inputValue").value}}),window.FbPhoneNumber});
