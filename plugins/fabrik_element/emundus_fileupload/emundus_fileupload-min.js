/**
 * File Upload Element
 *
 * @copyright: Copyright (C) 2005-2016  Media A-Team, Inc. - All rights reserved.
 * @license: GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */ function watch(e,t){var i=new FormData,a=document.querySelector("div.fb_el_"+e),n=document.querySelector("div#div_"+e),o=document.querySelector("input#"+e.split("___")[0]+"___fnum").value;i.append("attachId",t),i.append("fnum",o);var l=new XMLHttpRequest,s=document.createElement("div");s.setAttribute("id",e+"_attachment"),s.setAttribute("class","em-fileAttachment"),n.appendChild(s),l.open("POST","index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=emundus_fileupload&method=ajax_attachment",!0),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status&&""!=l.responseText){var i=JSON.parse(l.responseText);if(null!=i&&(i.limitObtained?(n.querySelector("div .btn-upload").hide(),n.querySelector("input#"+e).hide(),a.querySelector(".control-label").style.cursor="default"):(n.querySelector("div .btn-upload").show(),n.querySelector("input#"+e).show(),a.querySelector(".control-label").style.cursor="pointer"),i.files)){if(n.querySelector(".em-fileAttachmentTitle"))o=n.querySelector(".em-fileAttachmentTitle");else{var o=document.createElement("span");o.setAttribute("class","em-fileAttachmentTitle em-mt-8"),o.innerText=Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_UPLOADED_FILES"),s.appendChild(o)}for(var r=0;r<i.files.length;r++){var d=document.createElement("div");if(d.setAttribute("id",e+"_attachment_link"+r),d.setAttribute("class","em-fileAttachment-link"),document.getElementById(d.id)||s.appendChild(d),1==i.files[r].can_be_viewed){var p=document.createElement("a");p.setAttribute("href",i.files[r].target),p.setAttribute("target","_blank")}else var p=document.createElement("p");var u=document.createTextNode(i.files[r].local_filename);if(d.appendChild(p),p.appendChild(u),1==i.files[r].can_be_deleted){var c=document.createElement("a");c.setAttribute("class","em-pointer em-deleteFile em-ml-8"),c.setAttribute("value",i.files[r].filename);var h=document.createElement("span");h.setAttribute("class","material-icons-outlined"),h.setAttribute("style","font-size: 16px"),h.appendChild(document.createTextNode("clear")),c.appendChild(h),d.appendChild(c),document.querySelector("#"+e+"_attachment_link"+r+" > a.em-deleteFile").addEventListener("click",()=>FbFileUpload.delete(e,t))}}}}},l.send(i)}var FbFileUpload={initialize:function(e,t){var i=this;this.setPlugin("emundus_fileupload"),this.parent(e,t),this.container=jQuery(this.container),this.toppath=this.options.dir,"1"===this.options.folderSelect&&!0===this.options.editable&&this.ajaxFolder(),this.doBrowseEvent=null,this.watchBrowseButton(),this.options.ajax_upload&&!1!==this.options.editable&&(Fabrik.fireEvent("fabrik.fileupload.plupload.build.start",this),this.watchAjax(),0!==Object.keys(this.options.files).length&&(this.uploader.trigger("FilesAdded",this.options.files),jQuery.each(this.options.files,function(e,t){var a={filepath:t.path,uri:t.url,showWidget:!1},n=jQuery(Fabrik.jLayouts["fabrik-progress-bar-success"])[0],o=jQuery("#"+t.id).find(".bar")[0];i.uploader.trigger("UploadProgress",t),i.uploader.trigger("FileUploaded",t,{response:JSON.stringify(a)}),jQuery(o).replaceWith(n)})),this.redraw()),this.doDeleteEvent=null,this.watchDeleteButton(),this.watchTab()},redraw:function(){var e=jQuery(this.element);if(this.options.ajax_upload){var t=jQuery("#"+e.prop("id")+"_browseButton"),i=jQuery("#"+this.options.element+"_container"),a=t.position().left-i.position().left,n=i.closest(".fabrikElement").find("input[type=file]");if(n.length>0){var o=n.parent();o.css({width:t.width(),height:t.height()}),o.css("top",a)}}},doBrowse:function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t,i=this,a=e.target.files[0];if(a.type.match("image.*"))(t=new FileReader).onload=(function(e){return function(e){var t=jQuery(i.getContainer()),a=t.find("img");a.attr("src",e.target.result),a.closest(".fabrikHide").removeClass("fabrikHide"),t.find("[data-file]").addClass("fabrikHide")}}).bind(this)(a),t.readAsDataURL(a);else if(a.type.match("video.*")){var n,o=jQuery(this.getContainer()),l=o.find("video");if(l.length>0&&(l=this.makeVideoPreview()).appendTo(o),t=new window.FileReader,(t=window.URL||window.webKitURL)&&t.createObjectURL){n=t.createObjectURL(a),l.attr("src",n);return}if(!window.FileReader){console.log("Sorry, not so much");return}(t=new window.FileReader).onload=function(e){l.attr("src",e.target.result)},t.readAsDataURL(a)}}},watchFileAttachment:function(e,t){return watch(e,t)},upload:function(e,t,i,a){var n=new FormData,o=document.querySelector("div#div_"+e+" > input#"+e),l=document.querySelector("div#div_"+e),s=document.querySelector("div#div_"+e+" > a.em-deleteFile"),r=document.querySelector("input#"+e.split("___")[0]+"___fnum").value;n.append("attachId",t),n.append("elementId",e),n.append("fnum",r),n.append("size",i),n.append("encrypt",a);for(var d=[],p=0;p<o.files.length;p++)d=o.files[p],n.append("file[]",d);var u=new XMLHttpRequest;u.onreadystatechange=function(){if(4==u.readyState&&200==u.status){var i=JSON.parse(u.responseText);!1==i.status&&Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR_TEXT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}});for(var a=0;a<i.length;a++){if(!0==i[a].ext&&!0==i[a].size&&!1==i[a].nbMax){var n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name",e+"_filename"+a),n.setAttribute("value",i[a].filename),l.appendChild(n),Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_SUCCESS"),text:Joomla.JText._("PLG_ELEMENT_FIELD_UPLOAD"),type:"success",showConfirmButton:!1,timer:1500,customClass:{title:"em-swal-title"}})}!1==i[a].ext&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_EXTENSION"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),o.value="",null!=s&&(s.style.display="none")),!1==i[a].encrypt&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_ENCRYPT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),o.value=""),!1==i[a].size&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_SIZE")+i[a].maxSize,customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),o.value="",s.style.display="none"),!0==i[a].nbMax&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_LIMIT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),o.value="",s.style.display="none")}watch(e,t)}else 500==u.status&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR_TEXT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),o.value="",s.style.display="none")},u.open("POST","index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=emundus_fileupload&method=ajax_upload",!0),u.send(n)},delete:function(e,t){var i=document.querySelector("div#div_"+e),a=event.target,n=a.parentElement.parentElement.firstChild.innerText,o=a.parentElement.parentElement.firstChild.href.split("/");o=o[o.length-1],Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_SURE"),html:Joomla.JText._("PLG_ELEMENT_FIELD_SURE_TEXT")+"<strong>"+n+"</strong> ?",type:"warning",showCancelButton:!0,reverseButtons:!0,confirmButtonText:Joomla.JText._("PLG_ELEMENT_FIELD_CONFIRM"),cancelButtonText:Joomla.JText._("PLG_ELEMENT_FIELD_CANCEL"),customClass:{title:"em-swal-title",cancelButton:"em-swal-cancel-button",confirmButton:"em-swal-confirm-button"}}).then(n=>{if(n.value){document.querySelector("div#"+e+"_attachment");var l=document.querySelector("div#div_"+e+" > input#"+e),s=document.querySelector("input#"+e.split("___")[0]+"___fnum").value;let r=new FormData;r.append("filename",o),r.append("attachId",t),r.append("fnum",s),fetch("index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=emundus_fileupload&method=ajax_delete",{body:r,method:"post"}).then(e=>{if(e.ok)return e.json()}).then(t=>{t.status?(i.querySelector("div.btn-upload").show(),i.querySelector("input#"+e).show(),a.parentElement.parentElement.remove(),0===i.querySelectorAll(".em-fileAttachment-link").length&&document.querySelector("div#"+e+"_attachment > .em-fileAttachmentTitle").remove(),l.value="",Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE"),text:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE_TEXT"),type:"success",customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}})):Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE_FAILED"),text:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE_TEXT_FAILED"),type:"error",customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}})})}})},watchBrowseButton:function(){var e=jQuery(this.element);this.options.useWIP&&!this.options.ajax_upload&&!1!==this.options.editable&&(e.off("change",this.doBrowseEvent),this.doBrowseEvent=this.doBrowse.bind(this),e.on("change",this.doBrowseEvent))},doDelete:function(e){e.preventDefault();var t=jQuery(this.getContainer()),i=this,a=t.find("[data-file]");if(window.confirm(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_CONFIRM_SOFT_DELETE"))){var n=a.data("join-pk-val");new jQuery.ajax({url:"",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"emundus_fileupload",method:"ajax_clearFileReference",element_id:this.options.id,formid:this.form.id,rowid:this.form.options.rowid,joinPkVal:n}}).done(function(){Fabrik.trigger("fabrik.fileupload.clearfileref.complete",i)}),window.confirm(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_CONFIRM_HARD_DELETE"))&&(this.makeDeletedImageField(this.groupid,a.data("file")).appendTo(t),Fabrik.fireEvent("fabrik.fileupload.delete.complete",this)),a.remove(),jQuery(this.element).closest(".fabrikElement").find("img").attr("src",""!==this.options.defaultImage?Fabrik.liveSite+this.options.defaultImage:"")}},watchDeleteButton:function(){var e=jQuery(this.getContainer()).find("[data-file]");e.off("click",this.doDeleteEvent),this.doDeleteEvent=this.doDelete.bind(this),e.on("click",this.doDeleteEvent)},getFormElementsKey:function(e){return(this.baseElementId=e,this.options.ajax_upload&&this.options.ajax_max>1)?this.options.listName+"___"+this.options.elementShortName:this.parent(e)},removeCustomEvents:function(){},cloned:function(e){var t=jQuery(this.element);0!==t.closest(".fabrikElement").length&&(t.closest(".fabrikElement").find("img").attr("src",""!==this.options.defaultImage?Fabrik.liveSite+this.options.defaultImage:""),jQuery(this.getContainer()).find("[data-file]").remove(),this.watchBrowseButton(),this.parent(e))},decloned:function(e){jQuery("#form_"+this.form.id).find("input[name=fabrik_deletedimages["+e+"]]").length>0&&this.makeDeletedImageField(e,this.options.value).inject(this.form.form)},decreaseName:function(e){var t=this.getOrigField();return"null"!==typeOf(t)&&(t.name=this._decreaseName(t.name,e),t.id=this._decreaseId(t.id,e)),this.parent(e)},getOrigField:function(){var e=this.element.getParent(".fabrikElement"),t=e.getElement("input[name^="+this.origId+"_orig]");return"null"===typeOf(t)&&(t=e.getElement("input[id^="+this.origId+"_orig]")),t},makeDeletedImageField:function(e,t){return jQuery(document.createElement("input")).attr({type:"hidden",name:"fabrik_fileupload_deletedfile["+e+"][]",value:t})},makeVideoPreview:function(){var e=jQuery(this.element);return jQuery(document.createElement("video")).attr({id:e.prop("id")+"_video_preview",controls:!0})},update:function(e){if(this.element){var t=jQuery(this.element);if(""===e)this.options.ajax_upload?(this.uploader.files=[],t.parent().find("[id$=_dropList] tr").remove()):t.val("");else{var i=t.closest("div.fabrikSubElementContainer").find("img");i&&i.prop("src",e)}}},addDropArea:function(){if(Fabrik.bootstraped){var e,t=this.container.find("tr.plupload_droptext");t.length>0?t.show():(e=jQuery(document.createElementget("tr")).addClass("plupload_droptext").html('<td colspan="4"><i class="icon-move"></i> '+Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_DRAG_FILES_HERE")+" </td>"),this.container.find("tbody").append(e)),this.container.find("thead").hide()}},removeDropArea:function(){this.container.find("tr.plupload_droptext").hide()},watchAjax:function(){if(!1!==this.options.editable){var e=this,t=jQuery(this.element).prop("id"),i=jQuery(this.getElement());if(0!==i.length){var a=i.closest(".fabrikSubElementContainer");this.container=a,!1!==this.options.canvasSupport&&(this.widget=new ImageWidget(this.options.modalId,{imagedim:{x:200,y:200,w:this.options.winWidth,h:this.options.winHeight},cropdim:{w:this.options.cropwidth,h:this.options.cropheight,x:this.options.winWidth/2,y:this.options.winHeight/2},crop:this.options.crop,modalId:this.options.modalId,quality:this.options.quality})),this.pluploadContainer=a.find(".plupload_container"),this.pluploadFallback=a.find(".plupload_fallback"),this.droplist=a.find(".plupload_filelist");var n="index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax";n+="&plugin=fileupload&"+this.options.ajaxToken+"=1",n+="&method=ajax_upload&element_id="+this.options.elid,this.options.isAdmin&&(n="administrator/"+n);var o={runtimes:this.options.ajax_runtime,browse_button:t+"_browseButton",container:t+"_container",drop_element:t+"_dropList_container",url:n,max_file_size:this.options.max_file_size+"kb",unique_names:!1,flash_swf_url:this.options.ajax_flash_path,silverlight_xap_url:this.options.ajax_silverlight_path,chunk_size:this.options.ajax_chunk_size+"kb",dragdrop:!0,multipart:!0,filters:this.options.filters,page_url:this.options.page_url};this.uploader=new plupload.Uploader(o),this.uploader.bind("Init",function(t,i){e.pluploadFallback.remove(),e.pluploadContainer.removeClass("fabrikHide"),t.features.dragdrop&&t.settings.dragdrop&&e.addDropArea()}),this.uploader.bind("FilesRemoved",function(e,t){}),this.uploader.bind("FilesAdded",function(t,i){e.removeDropArea();var a,n=Fabrik.bootstrapped?"tr":"li";e.lastAddedFiles=i,Fabrik.bootstrapped&&e.container.find("thead").css("display",""),a=e.droplist.find(n).length,jQuery.each(i,function(t,i){if(i.size>1e3*e.options.max_file_size)window.alert(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_FILE_TOO_LARGE_SHORT"));else if(a>=e.options.ajax_max)window.alert(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_MAX_UPLOAD_REACHED"));else{var o,l,s;a++,e.isImage(i)?(o=e.editImgButton(),e.options.crop?o.html(e.options.resizeButton):o.html(e.options.previewButton),l=jQuery(document.createElement("span")).text(i.name)):(o=jQuery(document.createElement("span")),l=jQuery(document.createElement("a")).attr({href:i.url,target:"_blank"}).text(i.name)),s=e.imageCells(i,l,o),e.droplist.append(jQuery(document.createElement(n)).attr({id:i.id,class:"plupload_delete"}).append(s))}}),setTimeout(function(){t.start()},100)}),this.uploader.bind("UploadProgress",function(e,t){var i=jQuery("#"+t.id);if(i.length>0){if(Fabrik.bootstrapped){var a=i.find(".plupload_file_status .bar");if(a.css("width",t.percent+"%"),100===t.percent){var n=jQuery(Fabrik.jLayouts["fabrik-progress-bar-success"]);a.replaceWith(n)}}else i.find(".plupload_file_status").text(t.percent+"%")}}),this.uploader.bind("Error",function(t,i){e.lastAddedFiles.each(function(t){var a=jQuery("#"+t.id);a.length>0&&(a.remove(),window.alert(i.message)),e.addDropArea()})}),this.uploader.bind("ChunkUploaded",function(e,t,i){"object"==typeof(i=JSON.parse(i.response))&&i.error&&fconsole(i.error.message)}),this.uploader.bind("FileUploaded",function(t,i,a){var n,o,l,s,r,l=jQuery("#"+i.id);if((a=JSON.parse(a.response)).error){window.alert(a.error),l.remove();return}if(0===l.length){fconsole("Filuploaded didnt find: "+i.id);return}(s=l.find(".plupload_resize a")).show(),s.attr({href:a.uri,id:"resizebutton_"+i.id}),s.data("filepath",a.filepath),e.widget&&(o=!1!==a.showWidget,e.widget.setImage(a.uri,a.filepath,i.params,o)),n=e.options.inRepeatGroup?e.options.elementName.replace(/\[\d*\]/,"["+e.getRepeatNum()+"]"):e.options.elementName,jQuery(document.createElement("input")).attr({type:"hidden",name:n+"[crop]["+a.filepath+"]",id:"coords_"+i.id,value:JSON.stringify(i.params)}).insertAfter(e.pluploadContainer),jQuery(document.createElement("input")).attr({type:"hidden",name:n+"[cropdata]["+a.filepath+"]",id:"data_"+i.id}).insertAfter(e.pluploadContainer),r=[i.recordid,"0"].pick(),jQuery(document.createElement("input")).attr({type:"hidden",name:n+"[id]["+a.filepath+"]",id:"id_"+i.id,value:r}).insertAfter(e.pluploadContainer),l.removeClass("plupload_file_action").addClass("plupload_done"),e.isSubmitDone()}),this.uploader.init()}}},imageCells:function(e,t,i){var a,n,o,l,s=this.deleteImgButton();return Fabrik.bootstrapped?(l=jQuery(document.createElement("td")).addClass(this.options.spanNames[1]+" plupload_resize").append(i),o=Fabrik.jLayouts["fabrik-progress-bar"],n=jQuery(document.createElement("td")).addClass(this.options.spanNames[5]+" plupload_file_status").html(o),[a=jQuery(document.createElement("td")).addClass(this.options.spanNames[6]+" plupload_file_name").append(t),l,n,s]):(a=new Element("div",{class:"plupload_file_name"}).adopt([t,new Element("div",{class:"plupload_resize",style:"display:none"}).adopt(i)]),[a,s,n=new Element("div",{class:"plupload_file_status"}).set("text","0%"),new Element("div",{class:"plupload_file_size"}).set("text",e.size),new Element("div",{class:"plupload_clearer"})])},editImgButton:function(){var e=this;return Fabrik.bootstrapped?jQuery(document.createElement("a")).addClass("editImage").attr({href:"#",alt:Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_RESIZE")}).css({display:"none"}).on("click",function(t){t.preventDefault(),e.pluploadResize(jQuery(this))}):new Element("a",{href:"#",alt:Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_RESIZE"),events:{click:(function(e){e.stop();var t=e.target.getParent();this.pluploadResize(jQuery(t))}).bind(this)}})},deleteImgButton:function(){if(!Fabrik.bootstrapped)return new Element("div",{class:"plupload_file_action"}).adopt(new Element("a",{href:"#",style:"display:block",events:{click:(function(e){this.pluploadRemoveFile(e)}).bind(this)}}));var e=Fabrik.jLayouts["fabrik-icon-delete"],t=this;return jQuery(document.createElement("td")).addClass(this.options.spanNames[1]+" plupload_file_action").append(jQuery(document.createElement("a")).html(e).attr({href:"#"}).on("click",function(e){e.stopPropagation(),t.pluploadRemoveFile(e)}))},isImage:function(e){return void 0!==e.type?"image"===e.type:["jpg","jpeg","png","gif"].contains(e.name.split(".").pop().toLowerCase())},pluploadRemoveFile:function(e){if(e.stopPropagation(),window.confirm(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_CONFIRM_HARD_DELETE"))){var t=jQuery(e.target).closest("tr").prop("id").split("_").pop(),i=jQuery(e.target).closest("tr").find(".plupload_file_name").text(),a=[];this.uploader.files.each(function(e){e.id!==t&&a.push(e)}),this.uploader.files=a;var n=this,o={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"fileupload",method:"ajax_deleteFile",element_id:this.options.id,file:i,recordid:t,repeatCounter:this.options.repeatCounter};o[this.options.ajaxToken]=1,jQuery.ajax({url:"",data:o}).done(function(i){""===(i=JSON.parse(i)).error&&(Fabrik.trigger("fabrik.fileupload.delete.complete",n),jQuery(e.target).closest(".plupload_delete").remove(),jQuery("#id_alreadyuploaded_"+n.options.id+"_"+t).remove(),jQuery("#coords_alreadyuploaded_"+n.options.id+"_"+t).remove(),0===jQuery(n.getContainer()).find("table tbody tr.plupload_delete").length&&n.addDropArea())})}},pluploadResize:function(e){this.widget&&this.widget.setImage(e.attr("href"),e.data("filepath"),{},!0)},isSubmitDone:function(){this.allUploaded()&&"function"==typeof this.submitCallBack&&(this.saveWidgetState(),this.submitCallBack(!0),delete this.submitCallBack)},onsubmit:function(e){this.submitCallBack=e,this.allUploaded()?(this.saveWidgetState(),this.parent(e)):this.uploader.start()},saveWidgetState:function(){void 0!==this.widget&&jQuery.each(this.widget.images,function(e,t){var i=jQuery('input[name*="'+(e=e.split("\\").pop())+'"]').filter(function(e,t){return t.name.contains("[crop]")});if((i=i.last()).length>0){var a=t.img;delete t.img,i.val(JSON.stringify(t)),t.img=a}})},allUploaded:function(){var e=!0;return this.uploader&&this.uploader.files.each(function(t){0===t.loaded&&(e=!1)}),e}};define(["jquery","fab/element"],function(e,t){return window.FbEmundus_FileUpload=new Class({Extends:t,initialize:function(e,t){this.setPlugin("emundus_fileupload"),this.parent(e,t),this.options.editable&&this.options.scanQR&&(this.qrBtn=document.id(e+"_qr_upload"),this.qrBtn.addEvent("change",(function(e){let t=e.target,i=new FileReader,a=this;i.onload=function(){t.value="",qrcode.callback=(function(e){e instanceof Error?alert("No QR code found. Please make sure the QR code is within the camera's frame and try again."):a.update(e)}).bind(this),qrcode.decode(i.result)},i.readAsDataURL(t.files[0])}).bind(this)))},cloned:function(e){this.parent(e)}}),window.FbEmundus_FileUpload});
