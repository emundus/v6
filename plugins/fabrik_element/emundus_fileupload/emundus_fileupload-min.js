/**
 * File Upload Element
 *
 * @copyright: Copyright (C) 2005-2016  Media A-Team, Inc. - All rights reserved.
 * @license: GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */
function watch(e,t){var i=new FormData,a=document.querySelector("div.fb_el_"+e),o=document.querySelector("div#div_"+e),n=document.querySelector("input#"+e.split("___")[0]+"___fnum").value;i.append("attachId",t),i.append("fnum",n);var l=new XMLHttpRequest,r=document.createElement("div");r.setAttribute("id",e+"_attachment"),r.setAttribute("class","em-fileAttachment"),o.appendChild(r),l.open("POST","index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=emundus_fileupload&method=ajax_attachment",!0),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status&&""!=l.responseText){var i=JSON.parse(l.responseText);if(null!=i){var n=document.querySelector("input#"+e+"_description");if(void 0!==n&&(n.value=""),i.limitObtained){o.querySelector("div .btn-upload").hide(),o.querySelector("input#"+e).hide(),a.querySelector(".control-label").style.cursor="default";var s=document.querySelector("div#"+e+"_description_block");void 0!==s&&(s.style.display="none")}else o.querySelector("div .btn-upload").show(),o.querySelector("input#"+e).show(),a.querySelector(".control-label").style.cursor="pointer";if(i.files){if(o.querySelector(".em-fileAttachmentTitle"))d=o.querySelector(".em-fileAttachmentTitle");else{var d=document.createElement("span");d.setAttribute("class","em-fileAttachmentTitle em-mt-8"),d.innerText=Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_UPLOADED_FILES"),r.appendChild(d)}for(var p=0;p<i.files.length;p++){var u=document.createElement("div");if(u.setAttribute("id",e+"_attachment_link"+p),u.setAttribute("class","em-fileAttachment-link"),document.getElementById(u.id)||r.appendChild(u),1==i.files[p].can_be_viewed)(c=document.createElement("a")).setAttribute("href",i.files[p].target),c.setAttribute("target","_blank");else var c=document.createElement("p");var m=document.createTextNode(i.files[p].local_filename);if(u.appendChild(c),c.appendChild(m),1==i.files[p].can_be_deleted){var f=document.createElement("a");f.setAttribute("class","em-pointer em-deleteFile em-ml-8"),f.setAttribute("value",i.files[p].filename);var h=document.createElement("span");h.setAttribute("class","material-icons-outlined"),h.setAttribute("style","font-size: 16px"),h.appendChild(document.createTextNode("clear")),f.appendChild(h),u.appendChild(f),document.querySelector("#"+e+"_attachment_link"+p+" > a.em-deleteFile").addEventListener("click",(()=>FbFileUpload.delete(e,t)))}}}}}},l.send(i)}var FbFileUpload={initialize:function(e,t){var i=this;this.setPlugin("emundus_fileupload"),this.parent(e,t),this.container=jQuery(this.container),this.toppath=this.options.dir,"1"===this.options.folderSelect&&!0===this.options.editable&&this.ajaxFolder(),this.doBrowseEvent=null,this.watchBrowseButton(),this.options.ajax_upload&&!1!==this.options.editable&&(Fabrik.fireEvent("fabrik.fileupload.plupload.build.start",this),this.watchAjax(),0!==Object.keys(this.options.files).length&&(this.uploader.trigger("FilesAdded",this.options.files),jQuery.each(this.options.files,(function(e,t){var a={filepath:t.path,uri:t.url,showWidget:!1},o=jQuery(Fabrik.jLayouts["fabrik-progress-bar-success"])[0],n=jQuery("#"+t.id).find(".bar")[0];i.uploader.trigger("UploadProgress",t),i.uploader.trigger("FileUploaded",t,{response:JSON.stringify(a)}),jQuery(n).replaceWith(o)}))),this.redraw()),this.doDeleteEvent=null,this.watchDeleteButton(),this.watchTab()},redraw:function(){var e=jQuery(this.element);if(this.options.ajax_upload){var t=jQuery("#"+e.prop("id")+"_browseButton"),i=jQuery("#"+this.options.element+"_container"),a=t.position().left-i.position().left,o=i.closest(".fabrikElement").find("input[type=file]");if(o.length>0){var n=o.parent();n.css({width:t.width(),height:t.height()}),n.css("top",a)}}},doBrowse:function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t,i=this,a=e.target.files[0];if(a.type.match("image.*"))(t=new FileReader).onload=function(e){return function(e){var t=jQuery(i.getContainer()),a=t.find("img");a.attr("src",e.target.result),a.closest(".fabrikHide").removeClass("fabrikHide"),t.find("[data-file]").addClass("fabrikHide")}}.bind(this)(a),t.readAsDataURL(a);else if(a.type.match("video.*")){var o,n=jQuery(this.getContainer()),l=n.find("video");if(l.length>0&&(l=this.makeVideoPreview()).appendTo(n),t=new window.FileReader,(t=window.URL||window.webKitURL)&&t.createObjectURL)return o=t.createObjectURL(a),void l.attr("src",o);if(!window.FileReader)return void console.log("Sorry, not so much");(t=new window.FileReader).onload=function(e){l.attr("src",e.target.result)},t.readAsDataURL(a)}}},watchFileAttachment:function(e,t){return watch(e,t)},upload:function(e,t,i,a){var o=new FormData,n=document.querySelector("div#div_"+e+" > input#"+e),l=document.querySelector("div#div_"+e),r=document.querySelector("div#div_"+e+" > a.em-deleteFile"),s=document.querySelector("input#"+e.split("___")[0]+"___fnum").value;o.append("attachId",t),o.append("elementId",e),o.append("fnum",s),o.append("size",i),o.append("encrypt",a);var d=document.querySelector("input#"+e+"_description");void 0!==d&&o.append("description",d.value);for(var p=[],u=0;u<n.files.length;u++)p=n.files[u],o.append("file[]",p);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var i=JSON.parse(c.responseText);0==i.status&&Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR_TEXT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}});for(var a=0;a<i.length;a++){if(1==i[a].ext&&1==i[a].size&&0==i[a].nbMax){var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",e+"_filename"+a),o.setAttribute("value",i[a].filename),l.appendChild(o),Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_SUCCESS"),text:Joomla.JText._("PLG_ELEMENT_FIELD_UPLOAD"),type:"success",showConfirmButton:!1,timer:1500,customClass:{title:"em-swal-title"}})}0==i[a].ext&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_EXTENSION"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),n.value="",null!=r&&(r.style.display="none")),0==i[a].encrypt&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_ENCRYPT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),n.value=""),0==i[a].size&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_SIZE")+i[a].maxSize,customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),n.value="",r.style.display="none"),1==i[a].nbMax&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_LIMIT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),n.value="",r.style.display="none")}watch(e,t)}else 500==c.status&&(Swal.fire({type:"error",title:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR"),text:Joomla.JText._("PLG_ELEMENT_FIELD_ERROR_TEXT"),customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}}),n.value="",r.style.display="none")},c.open("POST","index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=emundus_fileupload&method=ajax_upload",!0),c.send(o)},delete:function(e,t){var i=document.querySelector("div#div_"+e),a=event.target,o=a.parentElement.parentElement.firstChild.innerText,n=a.parentElement.parentElement.firstChild.href.split("/");n=n[n.length-1],Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_SURE"),html:Joomla.JText._("PLG_ELEMENT_FIELD_SURE_TEXT")+"<strong>"+o+"</strong> ?",type:"warning",showCancelButton:!0,reverseButtons:!0,confirmButtonText:Joomla.JText._("PLG_ELEMENT_FIELD_CONFIRM"),cancelButtonText:Joomla.JText._("PLG_ELEMENT_FIELD_CANCEL"),customClass:{title:"em-swal-title",cancelButton:"em-swal-cancel-button",confirmButton:"em-swal-confirm-button"}}).then((o=>{if(o.value){document.querySelector("div#"+e+"_attachment");var l=document.querySelector("div#div_"+e+" > input#"+e),r=document.querySelector("input#"+e.split("___")[0]+"___fnum").value;const o=new FormData;o.append("filename",n),o.append("attachId",t),o.append("fnum",r),fetch("index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&plugin=emundus_fileupload&method=ajax_delete",{body:o,method:"post"}).then((e=>{if(e.ok)return e.json()})).then((t=>{if(t.status){i.querySelector("div.btn-upload").show(),i.querySelector("input#"+e).show();var o=document.querySelector("div#"+e+"_description_block");void 0!==o&&(o.style.display="block"),a.parentElement.parentElement.remove(),0===i.querySelectorAll(".em-fileAttachment-link").length&&document.querySelector("div#"+e+"_attachment > .em-fileAttachmentTitle").remove(),l.value="",Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE"),text:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE_TEXT"),type:"success",customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}})}else Swal.fire({title:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE_FAILED"),text:Joomla.JText._("PLG_ELEMENT_FIELD_DELETE_TEXT_FAILED"),type:"error",customClass:{title:"em-swal-title",confirmButton:"em-swal-confirm-button",actions:"em-swal-single-action"}})}))}}))},watchBrowseButton:function(){var e=jQuery(this.element);this.options.useWIP&&!this.options.ajax_upload&&!1!==this.options.editable&&(e.off("change",this.doBrowseEvent),this.doBrowseEvent=this.doBrowse.bind(this),e.on("change",this.doBrowseEvent))},doDelete:function(e){e.preventDefault();var t=jQuery(this.getContainer()),i=this,a=t.find("[data-file]");if(window.confirm(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_CONFIRM_SOFT_DELETE"))){var o=a.data("join-pk-val");new jQuery.ajax({url:"",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"emundus_fileupload",method:"ajax_clearFileReference",element_id:this.options.id,formid:this.form.id,rowid:this.form.options.rowid,joinPkVal:o}}).done((function(){Fabrik.trigger("fabrik.fileupload.clearfileref.complete",i)})),window.confirm(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_CONFIRM_HARD_DELETE"))&&(this.makeDeletedImageField(this.groupid,a.data("file")).appendTo(t),Fabrik.fireEvent("fabrik.fileupload.delete.complete",this)),a.remove(),jQuery(this.element).closest(".fabrikElement").find("img").attr("src",""!==this.options.defaultImage?Fabrik.liveSite+this.options.defaultImage:"")}},watchDeleteButton:function(){var e=jQuery(this.getContainer()).find("[data-file]");e.off("click",this.doDeleteEvent),this.doDeleteEvent=this.doDelete.bind(this),e.on("click",this.doDeleteEvent)},getFormElementsKey:function(e){return this.baseElementId=e,this.options.ajax_upload&&this.options.ajax_max>1?this.options.listName+"___"+this.options.elementShortName:this.parent(e)},removeCustomEvents:function(){},cloned:function(e){var t=jQuery(this.element);0!==t.closest(".fabrikElement").length&&(t.closest(".fabrikElement").find("img").attr("src",""!==this.options.defaultImage?Fabrik.liveSite+this.options.defaultImage:""),jQuery(this.getContainer()).find("[data-file]").remove(),this.watchBrowseButton(),this.parent(e))},decloned:function(e){jQuery("#form_"+this.form.id).find("input[name=fabrik_deletedimages["+e+"]]").length>0&&this.makeDeletedImageField(e,this.options.value).inject(this.form.form)},decreaseName:function(e){var t=this.getOrigField();return"null"!==typeOf(t)&&(t.name=this._decreaseName(t.name,e),t.id=this._decreaseId(t.id,e)),this.parent(e)},getOrigField:function(){var e=this.element.getParent(".fabrikElement"),t=e.getElement("input[name^="+this.origId+"_orig]");return"null"===typeOf(t)&&(t=e.getElement("input[id^="+this.origId+"_orig]")),t},makeDeletedImageField:function(e,t){return jQuery(document.createElement("input")).attr({type:"hidden",name:"fabrik_fileupload_deletedfile["+e+"][]",value:t})},makeVideoPreview:function(){var e=jQuery(this.element);return jQuery(document.createElement("video")).attr({id:e.prop("id")+"_video_preview",controls:!0})},update:function(e){if(this.element){var t=jQuery(this.element);if(""===e)this.options.ajax_upload?(this.uploader.files=[],t.parent().find("[id$=_dropList] tr").remove()):t.val("");else{var i=t.closest("div.fabrikSubElementContainer").find("img");i&&i.prop("src",e)}}},addDropArea:function(){if(Fabrik.bootstraped){var e,t=this.container.find("tr.plupload_droptext");t.length>0?t.show():(e=jQuery(document.createElementget("tr")).addClass("plupload_droptext").html('<td colspan="4"><i class="icon-move"></i> '+Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_DRAG_FILES_HERE")+" </td>"),this.container.find("tbody").append(e)),this.container.find("thead").hide()}},removeDropArea:function(){this.container.find("tr.plupload_droptext").hide()},watchAjax:function(){if(!1!==this.options.editable){var e=this,t=jQuery(this.element).prop("id"),i=jQuery(this.getElement());if(0!==i.length){var a=i.closest(".fabrikSubElementContainer");this.container=a,!1!==this.options.canvasSupport&&(this.widget=new ImageWidget(this.options.modalId,{imagedim:{x:200,y:200,w:this.options.winWidth,h:this.options.winHeight},cropdim:{w:this.options.cropwidth,h:this.options.cropheight,x:this.options.winWidth/2,y:this.options.winHeight/2},crop:this.options.crop,modalId:this.options.modalId,quality:this.options.quality})),this.pluploadContainer=a.find(".plupload_container"),this.pluploadFallback=a.find(".plupload_fallback"),this.droplist=a.find(".plupload_filelist");var o="index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax";o+="&plugin=fileupload&"+this.options.ajaxToken+"=1",o+="&method=ajax_upload&element_id="+this.options.elid,this.options.isAdmin&&(o="administrator/"+o);var n={runtimes:this.options.ajax_runtime,browse_button:t+"_browseButton",container:t+"_container",drop_element:t+"_dropList_container",url:o,max_file_size:this.options.max_file_size+"kb",unique_names:!1,flash_swf_url:this.options.ajax_flash_path,silverlight_xap_url:this.options.ajax_silverlight_path,chunk_size:this.options.ajax_chunk_size+"kb",dragdrop:!0,multipart:!0,filters:this.options.filters,page_url:this.options.page_url};this.uploader=new plupload.Uploader(n),this.uploader.bind("Init",(function(t,i){e.pluploadFallback.remove(),e.pluploadContainer.removeClass("fabrikHide"),t.features.dragdrop&&t.settings.dragdrop&&e.addDropArea()})),this.uploader.bind("FilesRemoved",(function(e,t){})),this.uploader.bind("FilesAdded",(function(t,i){e.removeDropArea();var a,o=Fabrik.bootstrapped?"tr":"li";e.lastAddedFiles=i,Fabrik.bootstrapped&&e.container.find("thead").css("display",""),a=e.droplist.find(o).length,jQuery.each(i,(function(t,i){var n,l,r;i.size>1e3*e.options.max_file_size?window.alert(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_FILE_TOO_LARGE_SHORT")):a>=e.options.ajax_max?window.alert(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_MAX_UPLOAD_REACHED")):(a++,e.isImage(i)?(n=e.editImgButton(),e.options.crop?n.html(e.options.resizeButton):n.html(e.options.previewButton),l=jQuery(document.createElement("span")).text(i.name)):(n=jQuery(document.createElement("span")),l=jQuery(document.createElement("a")).attr({href:i.url,target:"_blank"}).text(i.name)),r=e.imageCells(i,l,n),e.droplist.append(jQuery(document.createElement(o)).attr({id:i.id,class:"plupload_delete"}).append(r)))})),setTimeout((function(){t.start()}),100)})),this.uploader.bind("UploadProgress",(function(e,t){var i=jQuery("#"+t.id);if(i.length>0)if(Fabrik.bootstrapped){var a=i.find(".plupload_file_status .bar");if(a.css("width",t.percent+"%"),100===t.percent){var o=jQuery(Fabrik.jLayouts["fabrik-progress-bar-success"]);a.replaceWith(o)}}else i.find(".plupload_file_status").text(t.percent+"%")})),this.uploader.bind("Error",(function(t,i){e.lastAddedFiles.each((function(t){var a=jQuery("#"+t.id);a.length>0&&(a.remove(),window.alert(i.message)),e.addDropArea()}))})),this.uploader.bind("ChunkUploaded",(function(e,t,i){"object"==typeof(i=JSON.parse(i.response))&&i.error&&fconsole(i.error.message)})),this.uploader.bind("FileUploaded",(function(t,i,a){var o,n,l,r,s=jQuery("#"+i.id);if((a=JSON.parse(a.response)).error)return window.alert(a.error),void s.remove();0!==s.length?((l=s.find(".plupload_resize a")).show(),l.attr({href:a.uri,id:"resizebutton_"+i.id}),l.data("filepath",a.filepath),e.widget&&(n=!1!==a.showWidget,e.widget.setImage(a.uri,a.filepath,i.params,n)),o=e.options.inRepeatGroup?e.options.elementName.replace(/\[\d*\]/,"["+e.getRepeatNum()+"]"):e.options.elementName,jQuery(document.createElement("input")).attr({type:"hidden",name:o+"[crop]["+a.filepath+"]",id:"coords_"+i.id,value:JSON.stringify(i.params)}).insertAfter(e.pluploadContainer),jQuery(document.createElement("input")).attr({type:"hidden",name:o+"[cropdata]["+a.filepath+"]",id:"data_"+i.id}).insertAfter(e.pluploadContainer),r=[i.recordid,"0"].pick(),jQuery(document.createElement("input")).attr({type:"hidden",name:o+"[id]["+a.filepath+"]",id:"id_"+i.id,value:r}).insertAfter(e.pluploadContainer),s.removeClass("plupload_file_action").addClass("plupload_done"),e.isSubmitDone()):fconsole("Filuploaded didnt find: "+i.id)})),this.uploader.init()}}},imageCells:function(e,t,i){var a,o,n,l=this.deleteImgButton();return Fabrik.bootstrapped?(n=jQuery(document.createElement("td")).addClass(this.options.spanNames[1]+" plupload_resize").append(i),o=Fabrik.jLayouts["fabrik-progress-bar"],a=jQuery(document.createElement("td")).addClass(this.options.spanNames[5]+" plupload_file_status").html(o),[jQuery(document.createElement("td")).addClass(this.options.spanNames[6]+" plupload_file_name").append(t),n,a,l]):[new Element("div",{class:"plupload_file_name"}).adopt([t,new Element("div",{class:"plupload_resize",style:"display:none"}).adopt(i)]),l,a=new Element("div",{class:"plupload_file_status"}).set("text","0%"),new Element("div",{class:"plupload_file_size"}).set("text",e.size),new Element("div",{class:"plupload_clearer"})]},editImgButton:function(){var e=this;return Fabrik.bootstrapped?jQuery(document.createElement("a")).addClass("editImage").attr({href:"#",alt:Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_RESIZE")}).css({display:"none"}).on("click",(function(t){t.preventDefault(),e.pluploadResize(jQuery(this))})):new Element("a",{href:"#",alt:Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_RESIZE"),events:{click:function(e){e.stop();var t=e.target.getParent();this.pluploadResize(jQuery(t))}.bind(this)}})},deleteImgButton:function(){if(Fabrik.bootstrapped){var e=Fabrik.jLayouts["fabrik-icon-delete"],t=this;return jQuery(document.createElement("td")).addClass(this.options.spanNames[1]+" plupload_file_action").append(jQuery(document.createElement("a")).html(e).attr({href:"#"}).on("click",(function(e){e.stopPropagation(),t.pluploadRemoveFile(e)})))}return new Element("div",{class:"plupload_file_action"}).adopt(new Element("a",{href:"#",style:"display:block",events:{click:function(e){this.pluploadRemoveFile(e)}.bind(this)}}))},isImage:function(e){if(void 0!==e.type)return"image"===e.type;var t=e.name.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif"].contains(t)},pluploadRemoveFile:function(e){if(e.stopPropagation(),window.confirm(Joomla.JText._("PLG_ELEMENT_FILEUPLOAD_CONFIRM_HARD_DELETE"))){var t=jQuery(e.target).closest("tr").prop("id").split("_").pop(),i=jQuery(e.target).closest("tr").find(".plupload_file_name").text(),a=[];this.uploader.files.each((function(e){e.id!==t&&a.push(e)})),this.uploader.files=a;var o=this,n={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"fileupload",method:"ajax_deleteFile",element_id:this.options.id,file:i,recordid:t,repeatCounter:this.options.repeatCounter};n[this.options.ajaxToken]=1,jQuery.ajax({url:"",data:n}).done((function(i){""===(i=JSON.parse(i)).error&&(Fabrik.trigger("fabrik.fileupload.delete.complete",o),jQuery(e.target).closest(".plupload_delete").remove(),jQuery("#id_alreadyuploaded_"+o.options.id+"_"+t).remove(),jQuery("#coords_alreadyuploaded_"+o.options.id+"_"+t).remove(),0===jQuery(o.getContainer()).find("table tbody tr.plupload_delete").length&&o.addDropArea())}))}},pluploadResize:function(e){this.widget&&this.widget.setImage(e.attr("href"),e.data("filepath"),{},!0)},isSubmitDone:function(){this.allUploaded()&&"function"==typeof this.submitCallBack&&(this.saveWidgetState(),this.submitCallBack(!0),delete this.submitCallBack)},onsubmit:function(e){this.submitCallBack=e,this.allUploaded()?(this.saveWidgetState(),this.parent(e)):this.uploader.start()},saveWidgetState:function(){void 0!==this.widget&&jQuery.each(this.widget.images,(function(e,t){e=e.split("\\").pop();var i=jQuery('input[name*="'+e+'"]').filter((function(e,t){return t.name.contains("[crop]")}));if((i=i.last()).length>0){var a=t.img;delete t.img,i.val(JSON.stringify(t)),t.img=a}}))},allUploaded:function(){var e=!0;return this.uploader&&this.uploader.files.each((function(t){0===t.loaded&&(e=!1)})),e}};