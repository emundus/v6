if(typeof admintools.ControlPanel=="undefined"){admintools.ControlPanel={graph:{from:"",to:"",exceptPoints:[],subsPoints:[],typePoints:[]},plots:[null,null]}}(function(a){admintools.ControlPanel.loadGraphs=function(){function e(f,g){return Array(Math.max(g-String(f).length+1,0)).join(0)+f}admintools.ControlPanel.graph.from=document.getElementById("admintools_graph_datepicker").value;var b=new Date(admintools.ControlPanel.graph.from);b=new Date(b.getTime()+30*86400000);b=new Date(e(b.getUTCFullYear(),4)+"-"+e(b.getUTCMonth()+1,2)+"-"+e(b.getUTCDate(),2));admintools.ControlPanel.graph.to=b.toISOString().slice(0,10);admintools.ControlPanel.graph.lineLabels=[];admintools.ControlPanel.graph.pieLabels=[];admintools.ControlPanel.graph.exceptPoints=[];admintools.ControlPanel.graph.typePoints=[];var d=a("#admintoolsExceptionsPieChart");d.hide();a("#akthrobber2").show();var c=a("#admintoolsExceptionsLineChart");c.hide();a("#akthrobber").show();admintools.ControlPanel.loadExceptionsLineGraph()};admintools.ControlPanel.loadExceptionsLineGraph=function(){var b="index.php?option=com_admintools&view=SecurityExceptions&datefrom="+admintools.ControlPanel.graph.from+"&dateto="+admintools.ControlPanel.graph.to+"&groupbydate=1&savestate=0&format=json&limit=0&limitstart=0";a.getJSON(b,function(c){a.each(c,function(e,f){admintools.ControlPanel.graph.lineLabels.push(f.date);admintools.ControlPanel.graph.exceptPoints.push(parseInt(f.exceptions*100)/100)});a("#akthrobber").hide();var d=a("#admintoolsExceptionsLineChart");d.show();if(admintools.ControlPanel.graph.exceptPoints.length===0){d.hide();a("#admintoolsExceptionsLineChartNoData").show()}else{admintools.ControlPanel.renderExceptionsLineGraph()}admintools.ControlPanel.loadExceptionsPieGraph()})};admintools.ControlPanel.loadExceptionsPieGraph=function(){var b="index.php?option=com_admintools&view=SecurityExceptions&datefrom="+admintools.ControlPanel.graph.from+"&dateto="+admintools.ControlPanel.graph.to+"&groupbydate=0&groupbytype=1&savestate=0&format=json&limit=0&limitstart=0";a.getJSON(b,function(c){a.each(c,function(e,f){admintools.ControlPanel.graph.pieLabels.push(f.reason);admintools.ControlPanel.graph.typePoints.push(parseInt(f.exceptions*100)/100)});console.log();a("#akthrobber2").hide();var d=a("#admintoolsExceptionsPieChart");d.show();if(admintools.ControlPanel.graph.typePoints.length===0){d.hide();a("#admintoolsExceptionsPieChartNoData").show()}else{admintools.ControlPanel.renderExceptionsPieGraph()}})};admintools.ControlPanel.renderExceptionsLineGraph=function(){new Chart(document.getElementById("admintoolsExceptionsLineChart"),{type:"line",data:{labels:admintools.ControlPanel.graph.lineLabels,datasets:[{data:admintools.ControlPanel.graph.exceptPoints,fill:false,borderColor:"rgb(75, 192, 192)",lineTension:0.1}]},options:{legend:{display:false},scales:{yAxes:[{ticks:{beginAtZero:true}}]}}})};admintools.ControlPanel.renderExceptionsPieGraph=function(){new Chart(document.getElementById("admintoolsExceptionsPieChart"),{type:"pie",data:{labels:admintools.ControlPanel.graph.pieLabels,datasets:[{backgroundColor:["#40B5B8","#E2363C","#514F50","#92CF3B","#F0AD4E","#EFEFEF","yellow","green","purple"],data:admintools.ControlPanel.graph.typePoints,fill:false,borderColor:"rgb(75, 192, 192)",lineTension:0.1}]},options:{legend:{position:"right"}}})};admintools.ControlPanel.warnBeforePurgingSessions=function(b){if(!confirm(Joomla.JText._("COM_ADMINTOOLS_LBL_DATABASETOOLS_PURGESESSIONS_WARN"))){b.preventDefault();return false}};admintools.ControlPanel.showChangelog=function(){var b=a("#akeeba-changelog");b.modal("show")};admintools.ControlPanel.showUnblockMyself=function(){a.ajax("index.php?option=com_admintools&view=ControlPanel&task=selfblocked&tmpl=component",{data:{ip:admintools.ControlPanel.myIP},success:function(f){var c=f.match(/###([\s\S]*?)###/);var b=c[1];if(b==1){var e=a("#selfBlocked");var d=e.find("a");d.attr("href",d.attr("href")+"&ip="+admintools.ControlPanel.myIP);e.show()}}})};admintools.ControlPanel.showUpdateInformation=function(){a.ajax("index.php?option=com_admintools&view=ControlPanel&task=updateinfo&tmpl=component",{success:function(d,e,c){var b=d.match(/###([\s\S]*?)###/);data=b[1];if(data.length){a("#updateNotice").html(data)}}})};a(document).ready(function(b){admintools.ControlPanel.loadGraphs();admintools.ControlPanel.showUnblockMyself();admintools.ControlPanel.showUpdateInformation();b("#admintools_graph_reload").click(admintools.ControlPanel.loadGraphs);b("#optimize").click(admintools.ControlPanel.warnBeforePurgingSessions)})})(akeeba.jQuery);