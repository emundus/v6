/*!
 * @package   admintools
 * @copyright Copyright (c)2010-2021 Nicholas K. Dionysopoulos / Akeeba Ltd
 * @license   GNU General Public License version 3, or later
 */
;window.admintools=window.admintools||{};if(typeof admintools.ControlPanel=="undefined"){admintools.ControlPanel={modal:null,graph:{from:"",to:"",exceptPoints:[],subsPoints:[],typePoints:[]},plots:[null,null],myIP:"",showChangelog:function(){},cleanTmp:function(){},fixPerms:function(){},tmpLogCheck:function(){},optimizeDB:function(){},closeModal:function(){}}}admintools.ControlPanel.showTheChangeLogModalWindow=function(){akeeba.Modal.open({inherit:"#akeeba-changelog",width:"80%"})};admintools.ControlPanel.closeModal=function(){if(!admintools.ControlPanel.modal){return}admintools.ControlPanel.modal.close();admintools.ControlPanel.modal=null};admintools.ControlPanel.fixPerms=function(){admintools.ControlPanel.modal=akeeba.Modal.open({width:"600",height:"250",iframe:document.getElementById("fixperms").href});return false};admintools.ControlPanel.cleanTmp=function(){admintools.ControlPanel.modal=akeeba.Modal.open({width:"600",height:"250",iframe:document.getElementById("cleantmp").href});return false};admintools.ControlPanel.tmpLogCheck=function(){admintools.ControlPanel.modal=akeeba.Modal.open({width:"600",height:"250",iframe:document.getElementById("tmplogcheck").href});return false};admintools.ControlPanel.optimizeDB=function(){admintools.ControlPanel.modal=akeeba.Modal.open({width:"600",height:"250",iframe:document.getElementById("optimizedb").href});return false};admintools.ControlPanel.loadGraphs=function(){function b(c,d){return Array(Math.max(d-String(c).length+1,0)).join(0)+c}admintools.ControlPanel.graph.from=document.getElementById("admintools_graph_datepicker").value;var a=new Date(admintools.ControlPanel.graph.from);a=new Date(a.getTime()+30*86400000);a=new Date(b(a.getUTCFullYear(),4)+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2));admintools.ControlPanel.graph.to=a.toISOString().slice(0,10);admintools.ControlPanel.graph.lineLabels=[];admintools.ControlPanel.graph.pieLabels=[];admintools.ControlPanel.graph.exceptPoints=[];admintools.ControlPanel.graph.typePoints=[];document.getElementById("admintoolsExceptionsPieChart").style.display="none";document.getElementById("akthrobber2").style.display="block";document.getElementById("admintoolsExceptionsLineChart").style.display="none";document.getElementById("akthrobber").style.display="block";admintools.ControlPanel.loadBlockedRequestsGraph();admintools.ControlPanel.loadExceptionsPieGraph()};admintools.ControlPanel.loadBlockedRequestsGraph=function(){var a="index.php?option=com_admintools&view=SecurityExceptions&task=browse&datefrom="+admintools.ControlPanel.graph.from+"&dateto="+admintools.ControlPanel.graph.to+"&groupbydate=1&reason=&ip=&savestate=0&format=json&limit=0&limitstart=0";akeeba.System.doAjax({ajaxURL:a,parseResponseAsJSON:true,useTripleHash:false},function(d){var b={};var c=new Date(admintools.ControlPanel.graph.from);var f="";admintools.ControlPanel.graph.lineLabels=[];admintools.ControlPanel.graph.exceptPoints=[];while(true){if(f===admintools.ControlPanel.graph.to){break}function j(i){return(i<=9)?("0"+i):i}f=c.getFullYear()+"-"+j(c.getMonth()+1)+"-"+j(c.getDate());b[f]=0;c=new Date(c.getTime()+86400000)}for(var e=0;e<d.length;e++){var k=d[e];b[k.date]=parseInt(k.exceptions*100)/100}for(var h in b){if(!b.hasOwnProperty(h)){continue}admintools.ControlPanel.graph.lineLabels.push(h);admintools.ControlPanel.graph.exceptPoints.push(b[h])}document.getElementById("akthrobber").style.display="none";var g=document.getElementById("admintoolsExceptionsLineChart");g.style.display="block";if(d.length===0){g.style.display="none";document.getElementById("admintoolsExceptionsLineChartNoData").style.display="block";return}admintools.ControlPanel.renderBlockedRequestsGraph()})};admintools.ControlPanel.loadExceptionsPieGraph=function(){var a="index.php?option=com_admintools&view=SecurityExceptions&task=browse&datefrom="+admintools.ControlPanel.graph.from+"&dateto="+admintools.ControlPanel.graph.to+"&groupbydate=0&groupbytype=1&reason=&ip=&savestate=0&format=json&limit=0&limitstart=0";akeeba.System.doAjax({ajaxURL:a,parseResponseAsJSON:true,useTripleHash:false},function(e){admintools.ControlPanel.graph.pieLabels=[];admintools.ControlPanel.graph.typePoints=[];for(var b=0;b<e.length;b++){var d=e[b];admintools.ControlPanel.graph.pieLabels.push(d.reason);admintools.ControlPanel.graph.typePoints.push(parseInt(d.exceptions*100)/100)}document.getElementById("akthrobber2").style.display="none";var c=document.getElementById("admintoolsExceptionsPieChart");c.style.display="block";if(admintools.ControlPanel.graph.typePoints.length===0){c.style.display="none";document.getElementById("admintoolsExceptionsPieChartNoData").style.display="block"}else{admintools.ControlPanel.renderExceptionsPieGraph()}})};admintools.ControlPanel.renderBlockedRequestsGraph=function(){if(admintools.ControlPanel.plots[0]){admintools.ControlPanel.plots[0].destroy()}admintools.ControlPanel.plots[0]=new Chart(document.getElementById("admintoolsExceptionsLineChart"),{type:"line",data:{labels:admintools.ControlPanel.graph.lineLabels,datasets:[{data:admintools.ControlPanel.graph.exceptPoints,fill:true,borderColor:"#4BC0C0",backgroundColor:"rgb(81,79,80, 0.15)",tension:0.1}]},options:{plugins:{legend:{display:false}},scales:{x:{type:"time",time:{unit:"day"}},y:{ticks:{beginAtZero:true}}}}})};admintools.ControlPanel.renderExceptionsPieGraph=function(){if(admintools.ControlPanel.plots[1]){admintools.ControlPanel.plots[1].destroy()}admintools.ControlPanel.plots[1]=new Chart(document.getElementById("admintoolsExceptionsPieChart"),{type:"doughnut",data:{labels:admintools.ControlPanel.graph.pieLabels,datasets:[{backgroundColor:["#40B5B8","#E2363C","#514F50","#92CF3B","#F0AD4E","#EFEFEF","yellow","green","purple"],data:admintools.ControlPanel.graph.typePoints,fill:false,borderColor:"rgb(75, 192, 192)",lineTension:0.1}]},options:{plugins:{legend:{position:"right"}}}})};admintools.ControlPanel.warnBeforePurgingSessions=function(a){if(!confirm(Joomla.JText._("COM_ADMINTOOLS_LBL_DATABASETOOLS_PURGESESSIONS_WARN"))){a.preventDefault();return false}};admintools.ControlPanel.showUnblockMyself=function(){var a=akeeba.System.getOptions("admintools.ControlPanel.myIP");akeeba.System.doAjax({ajaxURL:"index.php?option=com_admintools&view=ControlPanel&task=selfblocked&tmpl=component",parseResponseAsJSON:true,useTripleHash:true,ip:a},function(b){if(b==1){var c=document.getElementById("#selfBlocked");var d=document.querySelectorAll("#selfBlocked > a");if(d.length<1){return}var e=d[0];e.href=e.href+"&ip="+a;c.style.display="block"}})};akeeba.Loader.add(["akeeba.System"],function(){akeeba.System.addEventListener("btnAdminToolsChangelog","click",admintools.ControlPanel.showTheChangeLogModalWindow);akeeba.System.addEventListener("cleantmp","click",admintools.ControlPanel.cleanTmp);akeeba.System.addEventListener("fixperms","click",admintools.ControlPanel.fixPerms);akeeba.System.addEventListener("tmplogcheck","click",admintools.ControlPanel.tmpLogCheck);akeeba.System.addEventListener("optimizedb","click",admintools.ControlPanel.optimizeDB);akeeba.System.addEventListener("optimize","click",admintools.ControlPanel.warnBeforePurgingSessions);akeeba.System.params.errorCallback=function(a){}});akeeba.Loader.add(["akeeba.System","akeeba.Ajax","Chart"],function(){var a=akeeba.System.getOptions("admintools.ControlPanel.graphs",1)!==0;if(!a){return}admintools.ControlPanel.loadGraphs();akeeba.System.addEventListener("admintools_graph_reload","click",function(b){admintools.ControlPanel.loadGraphs()})});akeeba.Loader.add(["akeeba.System","akeeba.Ajax"],function(){admintools.ControlPanel.showUnblockMyself()});