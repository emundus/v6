/*! Fabrik */

define(["jquery"],function(e){return new Class({Implements:[Options],options:{j3:!1},initialize:function(e,t,n){this.el=document.id(e),this.fields=t,this.setOptions(n),this.filters=[],this.counter=0},addHeadings:function(){new Element("thead").adopt(new Element("tr",{id:"filterTh",class:"title"}).adopt(new Element("th").set("text",Joomla.JText._("COM_FABRIK_JOIN")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_FIELD")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_CONDITION")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_VALUE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_TYPE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_APPLY_FILTER_TO")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_GROUPED")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_DELETE")))).inject(document.id("filterContainer"),"before")},deleteFilterOption:function(e){var t,n;if(this.counter--,e.stop(),this.options.j3){e.target.id.replace("filterContainer-del-","").toInt();n=e.target.getParent("tr"),t=e.target.getParent("table")}else n=e.target.getParent("tr"),t=e.target.getParent("table");0===this.counter&&t.hide(),this.options.j3?(n.getElements("input, select, textarea").dispose(),n.hide()):n.dispose()},_makeSel:function(e,t,n,l,a){var i=[];return(a=!0===a)&&i.push(new Element("option",{value:""}).set("text",Joomla.JText._("COM_FABRIK_PLEASE_SELECT"))),n.each(function(e){e.value===l?i.push(new Element("option",{value:e.value,selected:"selected"}).set("text",e.label)):i.push(new Element("option",{value:e.value}).set("text",e.label))}),new Element("select",{class:e,name:t}).adopt(i)},addFilterOption:function(e,t,n,l,a,i,o){var s,d,r,m,p;this.counter<=0&&(this.el.getParent("table").getElement("thead")||this.addHeadings()),e=e||"",t=t||"",n=n||"",l=l||"",a=a||"",o=o||"";var h=this.options.filterCondDd,E=new Element("tr");if(r=0===this.counter?new Element("span").set("text","WHERE").adopt(new Element("input",{type:"hidden",id:"paramsfilter-join",class:"inputbox",name:"jform[params][filter-join][]",value:e})):(d="AND"===e?(s=new Element("option",{value:"AND",selected:"selected"}).set("text","AND"),new Element("option",{value:"OR"}).set("text","OR")):(s=new Element("option",{value:"AND"}).set("text","AND"),new Element("option",{value:"OR",selected:"selected"}).set("text","OR")),new Element("select",{id:"paramsfilter-join",class:"inputbox input-small",name:"jform[params][filter-join][]"}).adopt([s,d])),this.counter<=0){(x=new Element("td")).appendChild(new Element("input",{type:"hidden",name:"jform[params][filter-grouped]["+this.counter+"]",value:"0"})),x.appendChild(new Element("span").set("text","n/a"))}else{var u="jform_params_filter-grouped_"+this.counter,c="jform[params][filter-grouped]["+this.counter+"]",_=new Element("fieldset",{class:"btn-group radio",id:u}),f={id:u+"_0",type:"radio",name:c,value:"0"};f.checked="1"!==o?"checked":"",_.appendChild(new Element("input",f)),f={for:u+"_0",class:"btn"+("1"!==o?" active btn-danger":"")},_.appendChild(new Element("label",f).set("text",Joomla.JText._("JNO"))),(f={id:u+"_1",type:"radio",name:c,value:"1"}).checked="1"===o?"checked":"",_.appendChild(new Element("input",f)),f={for:u+"_1",class:"btn"+("1"===o?" active btn-success":"")},_.appendChild(new Element("label",f).set("text",Joomla.JText._("JYES")));var x=new Element("td").adopt(_)}var w=new Element("td");w.appendChild(r);var C=new Element("td");C.innerHTML=this.fields;var v=new Element("td");v.innerHTML=h;var g=new Element("td"),T=new Element("td");T.innerHTML=this.options.filterAccess;var J=new Element("td"),O=new Element("textarea",{name:"jform[params][filter-value][]",cols:17,rows:2,style:"width:150px;"}).set("text",l);g.appendChild(O),g.appendChild(new Element("br"));var b=[{value:0,label:Joomla.JText._("COM_FABRIK_TEXT")},{value:1,label:Joomla.JText._("COM_FABRIK_EVAL")},{value:2,label:Joomla.JText._("COM_FABRIK_QUERY")},{value:3,label:Joomla.JText._("COM_FABRIK_NO_QUOTES")}],A=new Element("td").adopt(this._makeSel("inputbox elementtype input-small","jform[params][filter-eval][]",b,i,!1)),I=this.el.id+"-del-"+this.counter,R=this.options.j3?"":Joomla.JText._("COM_FABRIK_DELETE"),F='<button id="'+I+'" class="'+(this.options.j3?"btn btn-danger":"removeButton")+'"><i class="icon-minus" style="margin:0"></i> '+R+"</button>";if(J.set("html",F),E.appendChild(w),E.appendChild(C),E.appendChild(v),E.appendChild(g),E.appendChild(A),E.appendChild(T),E.appendChild(x),E.appendChild(J),this.el.appendChild(E),this.el.getParent("table").show(),document.id(I).addEvent("click",function(e){this.deleteFilterOption(e)}.bind(this)),document.id(this.el.id+"-del-"+this.counter).click=function(e){this.deleteFilterOption(e)}.bind(this),""!==e&&1<=(p=Array.mfrom(w.getElementsByTagName("SELECT"))).length)for(m=0;m<p[0].length;m++)p[0][m].value===e&&(p[0].options.selectedIndex=m);if(""!==t&&1<=(p=Array.mfrom(C.getElementsByTagName("SELECT"))).length)for(m=0;m<p[0].length;m++)p[0][m].value===t&&(p[0].options.selectedIndex=m);if(""!==n&&1<=(p=Array.mfrom(v.getElementsByTagName("SELECT"))).length)for(m=0;m<p[0].length;m++)p[0][m].value===n&&(p[0].options.selectedIndex=m);if(""!==a&&1<=(p=Array.mfrom(T.getElementsByTagName("SELECT"))).length)for(m=0;m<p[0].length;m++)p[0][m].value===a&&(p[0].options.selectedIndex=m);this.counter++}})});